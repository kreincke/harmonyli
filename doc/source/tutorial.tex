% mycsrf cloak file
%
% (c) Karsten Reincke, Frankfurt a.M. 2010, 2011, ff.
%
% This file is licensed under the Creative Commons Attribution 3.0 Germany
% License (http://creativecommons.org/licenses/by/3.0/de/): 
% For details see teh file LICENSE in the top directory
%
% select the document class
% S.26: [ 10pt|11pt|12pt onecolumn|twocolumn oneside|twoside notitlepage|titlepage final|draft
%         leqno fleqn openbib a4paper|a5paper|b5paper|letterpaper|legalpaper|executivepaper openrigth ]
% S.25: { article|report|book|letter ... }
%
% oder koma-skript S.10 + 16
\documentclass[
  DIV=calc,
  BCOR=5mm,
  12pt,
  headings=small,
  oneside,
  abstract=true,
  toc=bib,
  xcolor=dvipsnames,
  openany,
  ngerman,english]{scrartcl}
  
%%% (1) general configurations %%%
\usepackage[utf8]{inputenc}

%%% (2) language specific configurations %%%
\usepackage[]{a4,babel}
\selectlanguage{english}

% package for improving the grey value and the line feed handling
\usepackage{microtype}

%language specific quoting signs
%default for language english is american style of quotes
%\usepackage[english=british]{csquotes}
\usepackage[english=american]{csquotes}

% jurabib configuration
\usepackage[see]{jurabib}
\bibliographystyle{jurabib}
\input{cfg/inc.jbib-cfg.tex}

% language specific hyphenation
\input{cfg/inc.hyphenations.tex}

%%% (3) layout page configuration %%%

% select the visible parts of a page
% S.31: { plain|empty|headings|myheadings }
%\pagestyle{myheadings}
\pagestyle{headings}

% select the wished style of page-numbering
% S.32: { arabic,roman,Roman,alph,Alph }
\pagenumbering{arabic}
\setcounter{page}{1}

% select the wished distances using the general setlength order:
% S.34 { baselineskip| parskip | parindent }
% - general no indent for paragraphs
\setlength{\parindent}{0pt}
\setlength{\parskip}{1.2ex plus 0.2ex minus 0.2ex}


%%% (4) general package activation %%%
%\usepackage{utopia}
%\usepackage{courier}
%\usepackage{avant}
\usepackage[dvips]{epsfig}

% graphic

\usepackage{array}
\usepackage{shadow}
\usepackage{fancybox}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{wasysym}

\usepackage{chngcntr}


%- start(footnote-configuration)

\deffootnote[1.5em]{1.5em}{1.5em}{\textsuperscript{\thefootnotemark)\ }}

% if document class = book: count footnotes from start to end
%\counterwithout{footnote}{chapter}
%- end(footnote-configuration)

% package for macking tables with broken lines
\usepackage{multirow}

%for using label as nameref
\usepackage{nameref}

%integrate nomenclature
\input{cfg/inc.ncl-meta.tex}

% depth of contents
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}

% Hyperlinks
\usepackage[breaklinks=true]{hyperref}
\hypersetup{bookmarks=true,breaklinks=true,colorlinks=true,citecolor=blue,draft=false}
\newcommand{\acc}[0]{\textit}
\newcommand{\ra}[0]{$\rightarrow$}
\newcommand{\lnka}[1]{\href{#1}{\texttt{#1}}}
\newcommand{\lnkb}[2]{\href{#1}{\texttt{#1} (RDL: #2)}}
\newcommand{\lnkr}[1]{\ra\ \href{#1}{\texttt{#1}}}


\usepackage{harmony}
\usepackage{musicography}

%\usepackage{bigfoot}
\usepackage{verbatimbox}

\newcommand{\hlyn}[0]{\textit{harmonyli.ly}}
\newcommand{\hlyf}[0]{\texttt{harmonyli.ly}}
\newcommand{\lily}[0]{\textit{LilyPond}}
\newcommand{\has}[1]{\textit{Harmony Analysis Symbol#1}}


\usepackage{longtable}


\begin{document}

%% use all entries of the bliography
\nocite{*}

%%-- start(titlepage)
\titlehead{Tutorial}
\subject{Release \input{inc.rel.tex}}
\title{harmonyli.ly}
\subtitle{Harmonical Analysis Symbols in LilyPond Scores}
\author{Karsten Reincke\input{cfg/inc.license-fn.tex}}

%thanks entry cannot be combined with license footnote
%\thanks{den Autoren von KOMA-Script und denen von Jurabib}

\maketitle
%%-- end(titlepage)

\footnotesize
\tableofcontents

\normalsize

\section{Introduction}
As so often - in the beginning there was a need: I wanted to write a larger
scientific musicology work. Actually, I had a good starting point because I had
already created a \LaTeX package for humanities which fulfilled the requirements
of the scientific style I prefered. But I still had to evaluate how music
examples which harmonical analyses could be embedded into the \LaTeX\ source.


\section{Installation \& Integration}
\begin{itemize}
  \item Clone the \hlyn\ repository or download and extract the \hlyn\ zip
  archive by using the respective (github)
  commands.\footnote{\lnkr{https://github.com/kreincke/harmonyli.ly}}
  \item Copy the file \hlyf\ somewhere into your file system.
  \item Insert the command \texttt{\textbackslash include 
  "YOUR\_PATH\_TO/harmonyli.ly"} into
  your \lily\ file above the first \texttt{score\{\ldots\}} section.
  \item Expand your \texttt{layout\{\ldots\}} section by the line
   \texttt{\textbackslash context\{\textbackslash Lyrics \textbackslash consists
   "Text\_spanner\_engraver"\}}.
\end{itemize}

\section{Application \& Utilization}

\hlyn\ uses the lyrics technique of \lily\ to embed the \has{s} into the \lily\
score. The benefit is that \lily\ itself aligns the music notes and the
respective analysis symbols: it prevents horizontal overlappings, if a \has\ is
longer than the respective note.

As a little disadvantage \hlyn\ needs dedicated voice to which the row of
\has{s} can be bound. After having set up your \lily\ file as described above
you have three opportunities to fulfill this condition:

\subsection{Binding \has{s} to a Real Voice}

Linking \has{s} to a really used staff is straight forward: 

\subsubsection{Example}
\begin{center}
\begin{lilypond}

\version "2.18.2"

\header { tagline = "" }
\include "lilypond/harmonyli.ly"
  
\score {
  \new StaffGroup {
    \time 4/4
    <<
      \new Staff {
        \relative d' {
          \clef "treble"
          \key d \major  
          \stemUp
          < fis a d>2 < fis a dis> < g b e> < g b eis>2 | 
          < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
        }   
      }
      \new Staff {
        \relative d { 
          \clef "bass"
          \key d \major  
          \stemDown
          d2 b d cis  |
          d b d4 cis4 d2 \bar "||"
        }   
      }
      \addlyrics {
          \markup \setHas "T" #'(("C"."D")("fr" . " "))
          \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
          \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
          \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")("c" . "♭9>♯8")("fr" . " "))
          \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " ")) 
          \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")("fr" . " ")) 
                 
          \initTextSpan "  "
          \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
          \startTextSpan
          \markup \expZoomRow #'(("a"."3")("fr" . " ")) 
          \stopTextSpan
  
          \markup \setHas "T" #'(("fr" . " "))
        }
    >>
  }
  \layout {
    \context {
      \Lyrics
      \consists "Text_spanner_engraver"
    }
  }
  \midi {}
}
\end{lilypond}
\end{center}

\subsubsection{Code}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "harmonyli.ly"
\score {
  \new StaffGroup {
    \time 4/4
    <<
      \new Staff {
        \relative d' {
          \clef "treble" \key d \major \stemUp
          < fis a d>2 < fis a dis> < g b e> < g b eis>2 | 
          < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
      } }   

      \new Staff {
        \relative d { 
          \clef "bass" \key d \major \stemDown
          d2 b d cis  | d b d4 cis4 d2 \bar "||"
      } }   
      
      \addlyrics {
          \markup \setHas "T" #'(("C"."D")("fr" . " "))
          \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
          \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
          \markup \setHas "D" #'(("T"."x")("B"."3")
                                ("a" . "5")("b" . "7")("c" . "-9>+8")("fr" . " "))
          \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " ")) 
          \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                                ("fr" . " "))    
          \initTextSpan "   "
          \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
          \startTextSpan
          \markup \expZoomRow #'(("a"."3")("fr" . " ")) 
          \stopTextSpan
          \markup \setHas "T" #'(("fr" . " "))
        }
    >>
  }
  \layout { \context{\Lyrics\consists "Text_spanner_engraver"} }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

\subsubsection{Remarks}

This example contains a descant staff and a bass voice. To the letter one, it
appends the section \texttt{addlyrics}, which contains for each note of the bass
voice one specific \has. If you do not want to use such a 1:1 relation between
notes and \has{s}, you can use one of the other methods.

\subsection{Binding \has{s} to a Hidden Voice}

Linking the \has{s} to an invisible voice is a bit tricky: First, you must
design your staff as a staff with several voices. Then you inscribe a (mostly
very deep) 'artificial' voice into that staff and bind the symbols to that
'artificial' voice.\footnote{For demonstrating this option, we have colored the
'hidden' voice. If you change the string \texttt{new Voice = "AnalysisSubline"}
into \texttt{new NullVoice = "AnalysisSubline"}, the voice becomes really
invisble.}

This method is good for a score with a large amplitude of pitches (as some
romantic piano pieces use): by applying the method you can enforce a larger
distance between the used notes and the \has{s}.

\subsubsection{Example}
\begin{center}
\begin{lilypond}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing #'basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 | 
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythmHidden =
\relative c, {
  \clef bass \stemDown \global
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "♭9>♯8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " ")) 
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))    
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " ")) 
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }
      { <<
          \descant 
        >>
      }
      \new Staff = lower
      \new Voice = "Musical Bass"
      \with { printPartCombineTexts = ##f }
      { <<
          \bass
          % change "Voice" to "NullVoice" to make analyze voice unvisible:
          \new Voice = "AnalysisSubline" {\shiftOff  \hasRhythmHidden}
          \new Lyrics \lyricsto "AnalysisSubline" \hasSymbols
        >>
      }
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
} 
\end{lilypond}
\end{center}

\subsubsection{Code}
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing #'basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 | 
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythmHidden =
\relative c, {
  \clef bass \stemDown \global
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "-9>+8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " ")) 
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))    
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " ")) 
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }
      { <<
          \descant 
        >>
      }
      \new Staff = lower
      \new Voice = "Musical Bass"
      \with { printPartCombineTexts = ##f }
      { <<
          \bass
          % change "Voice" to "NullVoice" to make analyze voice unvisible:
          \new Voice = "AnalysisSubline" {\shiftOff  \hasRhythmHidden}
          \new Lyrics \lyricsto "AnalysisSubline" \hasSymbols
        >>
      }
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
} 
\end{verbatim}
\end{scriptsize}

\subsubsection{Remarks}

This example uses four voices in four variables: the right hand voice
(\texttt{= descant}), the left hand voice (\texttt{= bass)}, the hidden voice
defining the rhythmical granularity of the analysis (\texttt{= hasRhythmHidden})
and the respective stream of \has{s} (\texttt{= hasSymbols}). Inside of the
section \texttt{\textbackslash score{\ldots}} the 'sounding' bass and the
'virtual' voice \acc{AnalysisSubline} are inserted into the left hand staff. And
the stream of \has{s} \texttt{\textbackslash hasSymbols} is bound to that
'virtual' voice by using the command \texttt{\textbackslash lyristico} and a
reference by name.\footnote{Due to fact, that the \has{s} appear under the
analysis staff, it sometimes happens, that next part of your score (after the
system 'linefeed') is visually not sufficiently separated from the preceding
system. That agravates to read the score fluently. For increasing or decreasing
the distance between the system lines, you can play around with the values
inserted into the section \texttt{\textbackslash page\{\ldots\}}}


\subsection{Binding \has{s} to a Dedicated 'Analysis' Staff}

Binding the \has{s} to a specific \acc{analysis} staff is straight forward
again: you must create a voice in a special staff which only represents the
rhythm. 

This method is good for scores with many staves (like those of symphonies etc.):
it simplifies to ignore the harmonically irrelevant passing notes.

\subsubsection{Example}
\begin{center}
\begin{lilypond}

\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing #'basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 | 
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythm = \relative c {
  \stemDown \global
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "♭9>♯8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " ")) 
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))    
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " ")) 
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }{\descant}
      \new Staff = lower
      \with { printPartCombineTexts = ##f }{\bass}
    >>
    \new RhythmicStaff = analysis
    \with { printPartCombineTexts = ##f }
    {
      << 
      \new Voice = "AnalysisLine" { \hasRhythm}
      \new Lyrics \lyricsto "AnalysisLine" \hasSymbols
      >>
    }
  >>

  \layout{ \context{\Lyrics\consists "Text_spanner_engraver"}}
} 

\end{lilypond}
\end{center}


\subsubsection{Code}
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing #'basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 | 
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythm = \relative c {
  \stemDown \global
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "+9>-8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " ")) 
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))    
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " ")) 
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }{\descant}
      \new Staff = lower
      \with { printPartCombineTexts = ##f }{\bass}
    >>
    \new RhythmicStaff = analysis
    \with { printPartCombineTexts = ##f }
    {
      << 
      \new Voice = "AnalysisLine" { \hasRhythm}
      \new Lyrics \lyricsto "AnalysisLine" \hasSymbols
      >>
    }
  >>

  \layout{ \context{\Lyrics\consists "Text_spanner_engraver"}}
} 

\end{verbatim}
\end{scriptsize}

\subsubsection{Remarks}

In general, this third example follows the ideas of the second. But it does not
inscribe the sounding bass and the 'virtual' analysis voice into the same staff.
Instead of this, each of them gets its own staff. And again, the stream of
\has{s} is linked to the analysis voice \acc{hasRhythm} by the command
\texttt{\textbackslash lyristico} and a name reference.

\section{\has{s}}

After having generally explained how to integrate and use \hlyn, we can now
discuss, how particular \has{s}\ are generated by \hlyn\ commands. For that
purpose, \hlyn\ offers two interfaces: the basic \hlyn functions and some
often used instantiations. This chapter describes the general interface: 

\subsection{The basic \hlyn-functions}
The basic interface of \hlyn\ contains nine functions:

\begin{longtable}
  { r
    >{\raggedleft\hspace{0pt}}p{4cm}
    c
    >{\raggedright\hspace{0pt}}p{8cm}
   }
 
(01) & \textbf{setHas} & \ra & inserts a \has{}.
\tabularnewline
(02) & \textbf{setImHas} & \ra & inserts an \acc{Intermediary \has{}} whose
function refers to the root of the successing chord instead of being determined
by the keynote.
\tabularnewline
(03) & \textbf{setRfHas} & \ra & inserts a \acc{Reframing \has{}} as it is
required by modulations: the function of a chord -- determined by the current
tonal center -- is reinterpreted as a function in the context of the next tonal
center
\tabularnewline
(04) & \textbf{openImRow} & \ra & starts a chain of \acc{Intermediary \has{s}}
which together refer to the root of the successing chord
\tabularnewline
(05) & \textbf{closeImRow} & \ra & closes a chain of \acc{Intermediary \has{s}}
and indicates, that the root of the directly successing chord is the tonal
center of that chain
\tabularnewline
(06) & \textbf{openZoomRow} & \ra & starts the zoom into a \has{} which shall 
cover suspended or passing notes
\tabularnewline
(07) & \textbf{expZoomRow} & \ra & expands an opened \has{} by a description of
suspended or passing notes which do not modify the current harmonical function
\tabularnewline
(08) & \textbf{openImZoomRow}  & \ra & starts the zoom into an intermediary
\has{} which shall cover suspended or passing notes
\tabularnewline
(09) & \textbf{closeImZoomRow} & \ra &  closes the zoom into a intermediary
\has{} which covers suspended or passing notes
\tabularnewline

\end{longtable}


\subsection{How to combine these \hlyn-functions correctly}

In accordance to the following eBNF
grammer\footnote{for details \ra\ 
\lnka{https://en.wikipedia.org/wiki/Extended\_Backus\%E2\%80\%93Naur\_form}
and/or \lnka{https://en.wikipedia.org/wiki/Backus-Naur\_form}
}, you can embed five types of subrows
into your stream of \has{s}\footnote{Note: \hlyn\ intends to be complete, but
not correct. This -- maybe surprising -- statement must be explained: In
computer sciences one discusses the correctness and the completeness of a
process for deriving syntagms by using a semantical interpretation of each
derivable syntagm. The construct (language and process) is \textbf{complete}, if
for any intended real world object a syntagm can be derived which refers to that
real world element. And the construct is \textbf{correct} if each derivable
syntagm refers to a real world object. For human beings in general and
musicologist in particular it is more important to use a \textbf{complete} 
language (of \has{s}) than using a correct language: We want to know that
we can express whatever we want to express, because our language is complete.
And we can avoid wrong / meaningless syntagms manually, so that the fact, that
our language is not correct (in the sense of computer languages) does not
matter. Therefore, we want to say that
\begin{itemize}
  \item \textbf{all} 'subrows' of \has{s} which are necessary to describe the
  harmonic relationships of real world chords must be formulatable by \hlyn.
  \item \textbf{not all} 'subrows' of \has{s} which can be generated by \hlyn\
  necessarily describe possible chord chains.
\end{itemize}
A last remark: If one had a correct and complete language for describing streams
of harmonical chords, then one would have a complete theory of harmonization
which no longer needs the help of 'unrepresented human knowledge'.
Delivering such a theory is far beyond the target of \hlyn.
}:

\begin{verbatim}
HasStream ::- ( setHas | setImHas | setRfHas |
                openImRow, setHas*, closeImRow |
                openZoomRow, expZoomRow+ |
                openImZoomRow, expZoomRow*, closeImZoomRow )+
\end{verbatim}

These production rules inidicate, that 
\begin{itemize}
  \item you may use the \has{s}\ itself without having to consider its
  predecessors or successors
  \item you must close an opened intermediate row and between the opening and
  the closing element of that chain you can insert as many normal \has{s} as you
  want
  \item you need not explicitly to close an opened zoom
\end{itemize}


\subsection{The Syntax of a \has{}}

Typical \has{s}\ look like these:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a' d''>1 
    < b g' d'' e''>1 
    < cis' e' a' e''>1 
    < cis' g' b' e''>1 
    < d' gis' b' e''>1 
    < d' gis' b' e''>1 
    < cis' g' a' e''>1 
    < d' fis' a' d''>1 
  }
  \addlyrics { 
    \markup \setHas "T" #'()
    \markup \setHas "S" #'(("B"."3")("a"."5")("b"."6"))
    \markup \setHas "D" #'(("B"."3"))
    \markup \setHas "D" #'(("T"."x")("B"."3")("S"."5")("a"."7")("b"."9"))
    \markup \setHas "D" #'(("T"."d")("B"."7")("a"."7")("b"."8"))
    \markup \setImHas "D" #'(("B"."7")("a"."7")("b"."8"))
    \markup \setHas "D" #'(("B"."3")("a"."7")("b"."8"))
    \markup \setHas "T" #'()
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

They are created by different \hlyn\ functions, which -- nevertheless -- take
the same kind of parameters\footnote{except \texttt{setRfHas} and
\texttt{expZoomRow}}: The function symbol is obligatoric and specified as string
argument. The other parameters are optional and handed over in a list of
attributes. Let us visualize the structure of a \has{}\ by \hlyn\ itself:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
   < fis' a' b' d'' e''>1 }
  \addlyrics { 
    \markup 
      \setHas "Functionsymbol" 
        #'( ("B"."B ::- Bassnote")
            ("S"."S ::- Soprannote")
            ("C"."C ::- Context")
            ("a"."a ::- first modifier")
            ("b"."b ::- second modifier")
            ("c"."c ::- third modifier")
            ("d"."d ::- fourth modifier")
            ("e"."e ::- fifth modifier")
            ("fl"."fl ::- präfix ")
            ("fr"." fr ::- suffix")
        ) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

The general syntax to specify such a \has{}\ is this:

\begin{scriptsize}
\begin{verbatim}
...
  \addlyrics { 
    ...
    \setHas
      "T"             ; the function symbol
      #               ; indicator to read the following syntagm as scheme term
      `               ; indicator to evalute the syntagm and insert the result
      (               ; start of the syntagm 'attribute list'
        ("B" . "3")   ; insert a bass note 3
        ("S" . "8")   ; insert a sopran note 8
        ("C" ."D Major") ; explicate the keynote as reference
        ("a" . "3")   ; insert the lowest number beside the functional symbol
        ("b" . "5")   ; insert the second number beside the functional symbol
        ("c" . "6")   ; insert the third number beside the functional symbol
        ("d" . "8")   ; insert the fourth number beside the functional symbol
        ("e" . "9")   ; insert the fifth number beside the functional symbol
        ("fl" ."any-prefix ") ; insert a prefix before the harmony analysis symbol
        ("fr" ." any-suffix") ; insert a suffix after the harmony analysis symbol
      )               ; end of the attribute list
    ...
  }
\end{verbatim}
\end{scriptsize}

In general, you can skip the attributes which you do not want to use. And you
can insert the attributes you want to use in any succession you prefer.
Howsoever, the presented example would create the following output:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
  < fis' a' b' d'' e''>1 }
  \addlyrics { 
    \markup 
      \setHas "T" 
        #'( ("B" . "3")   
            ("S" . "9")
            ("C" ."D Major")  
            ("a" . "3")   
            ("b" . "5")   
            ("c" . "6")  
            ("d" . "8")  
            ("e" . "9")  
            ("fl" ."any-prefix ") 
            ("fr" ." any-suffix") 
        ) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

For modifying this example\footnote{Later, we will explicitly describe the
purpose of this feature 'explicating the context'. Up to that point we will
ignore this opportunity in our examples.} into an intermediary chord, you only
must replace the function \texttt{\textbackslash setHas} by the function
\texttt{\textbackslash setImHas}. As the result you will get this:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
  < fis' a' b' d'' e''>1 }
  \addlyrics { 
    \markup 
      \setImHas "T" 
        #'( ("B" . "3")   
            ("S" . "9")   
            ("a" . "3")   
            ("b" . "5")   
            ("c" . "6")  
            ("d" . "8")  
            ("e" . "9")  
            ("fl" ."any-prefix ") 
            ("fr" ." any-suffix") 
        ) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

If you want to cross out the functional symbol for indicating that the root is
not part of the chord or if you want to double the functional symbol for
indicating that it is a second level function or if you want to indicate both
aspects, simply add the attribute \verb|("T"."x")| respectively
\verb|("T"."d")| respectively \verb|("T"."dx")| or \verb|("T"."xd")|:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key c \major \time 4/4 \stemUp 
  < fis' a' b' c'' e''>1 
  < fis' a' b' c'' e''>1 
  < fis' a' b' c'' e''>1 }
  \addlyrics { 
    \markup \setHas "D" 
        #'( ("T" . "x")("B" . "3")("S" . "9")   
            ("a" . "3")("b" . "5")("c" . "6")("d" . "7")("e" . "9")) 
    \markup \setHas "D" 
        #'( ("T" . "d")("B" . "3")("S" . "9")   
            ("a" . "3")("b" . "5")("c" . "6")("d" . "7")("e" . "9"))         
    \markup \setHas "D" 
        #'( ("T" . "xd")("B" . "3")("S" . "9")   
            ("a" . "3")("b" . "5")("c" . "6")("d" . "7")("e" . "9"))        
        }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\section{\has{s}: Simple and Complex Examples}

After having explained the general methods to create a \has{}, we can now show
how one can fulfill specific musical needs by these techniques:

\subsection{Inserting a Function Symbol}

The majority of Anglo-Saxonian musicologists use something like the
'scale-step-theory' by which each tone of scale and the respective chord is
referred by the respective number (represented by a Roman numeral).
Alternatively one can use the functional (harmony) theory by which the chords of
a scale are referred by their harmonical functions (represented by
characters).\footcite[for dedails cf.][\nopage wp]{wpFunctionTheory2019a} Both
methods can be expressed by \hlyn: Insert the respective symbol as first
argument of the \hlyn\ basic functions. If you don't need any additional
specifier, add at least an empty attribution list \texttt{\#'()}:

\begin{center}
\begin{lilypond}

\version "2.18.2"

\header { tagline = "" }
\include "lilypond/harmonyli.ly"
  
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a'>1 
    < e' g' b' >1  
    < fis' a' cis'' >1
    < g' b' d'' >1  
    < a' cis'' e'' >1 
    < b' d'' fis'' >1  
    < cis'' e'' g'' >1
  }
  \addlyrics {
    \markup \setHas "I" #'()
    \markup \setHas "II" #'()
    \markup \setHas "III" #'()
    \markup \setHas "IV" #'()
    \markup \setHas "V" #'()
    \markup \setHas "VI" #'()
    \markup \setHas "VII" #'()
  }
  \addlyrics {
    \markup \setHas "T" #'()
    \markup \setHas "Sp" #'()
    \markup \setHas "Tg/Dp" #'()
    \markup \setHas "S" #'()
    \markup \setHas "D" #'()
    \markup \setHas "Tp/Sg" #'()
    \markup \setHas "D" #'(("T"."x")("a" . "7"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}

\end{lilypond}
\end{center}
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"

\header { tagline = "" }
\include "lilypond/harmonyli.ly"
  
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a'>1 
    < e' g' b' >1  
    < fis' a' cis'' >1
    < g' b' d'' >1  
    < a' cis'' e'' >1 
    < b' d'' fis'' >1  
    < cis'' e'' g'' >1
  }
  \addlyrics {
    \markup \setHas "I" #'()
    \markup \setHas "II" #'()
    \markup \setHas "III" #'()
    \markup \setHas "IV" #'()
    \markup \setHas "V" #'()
    \markup \setHas "VI" #'()
    \markup \setHas "VII" #'()
  }
  \addlyrics {
    \markup \setHas "T" #'()
    \markup \setHas "Sp" #'()
    \markup \setHas "Tg/Dp" #'()
    \markup \setHas "S" #'()
    \markup \setHas "D" #'()
    \markup \setHas "Tp/Sg" #'()
    \markup \setHas "D" #'(("T"."x")("a" . "7"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating a Bass Note}

In the context of the scale-step-theory, the bass note is referred by the Roman
numeral which is inserted as a functional symbol. Hence, the  scale-step-theory
does not have the need to additionally indicate the bass note.

In the context of the functional harmony theory the chord is referred by its
function. By default the respective symbol implies that the root is the bass
note and that the chord uses the third and the fifth. Therefore, the bass note
of a described chord is only revealed if it is not the root of the chord. For
indicating the bass note expand the attribute list by the
string \texttt{("B"."YOUR\_NUMBER")}:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' d'' a''>1 }
  \addlyrics { \markup \setHas "T" #'(("B"."3")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' d'' a''>1 }
  \addlyrics { 
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "T" #'(("B"."3"))| }
\begin{verbatim}    
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating a Sopran Note}

Sometimes, a musicologist wants to explicitly specify the highest tone of a
chord. For indicating the 'soprano' note expand the attribute list by the string
\texttt{("S"."YOUR\_NUMBER")}:
\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < d' a' d'' fis''>1 }
  \addlyrics { \markup \setHas "T" #'(("S"."3")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' d'' a''>1 }
  \addlyrics { 
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "T" #'(("S"."3"))| }
\begin{verbatim}    
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating Descant Tones}

In accordance to the method for writing a basso continuo, both theories
explicitly display the numbers of those chord tones which shall be used, but
which are not covered by the default rule 'take 1+3+5+8'. And with respect to
the other composition rule 'by default combine thirds' each number implictly
supresses its predecessor and successor. Hence, if the chord contains a second,
the two respective adjacent numbers must be revealed.

\hlyn\ allows you to add up to five deviating tones by inserting the strings
\texttt{("a"."YOUR\_NUMBER")}, \ldots, \texttt{("e"."YOUR\_NUMBER")} into the
attribute list. Additionally, these numbers can be altered by using the standard
UTF8 / unicode signs \{\musDoubleFlat , \musFlat , \musNatural , \musSharp ,
\musDoubleSharp \}\footnote{We use the \LaTeX\ command
 \texttt{\textbackslash verbatim} for showing the \lily\ code which creates the
 example. Unfortunately, we can not use special Unicode signs in these sections.
As a substitute we use \texttt{+} for \musSharp, \texttt{-} for \musFlat\ and 
 \texttt{*} for \musNatural. }:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < a' c'' es'' f'' g'' bis''>1 
  }
  \addlyrics { 
    \markup \setHas "D" #'(("a"."3♮")("b"."5♭")("c"."6♮")("d"."7")("e"."9♯")) 
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < a' c'' es'' f'' g'' bis''>1 
  }
  \addlyrics {
  \end{verbatim}
  { \color{red} \verb|    \markup \setHas "D" #'(("a"."3*")("b"."5-")("c"."6*")("d"."7")("e"."9+")) |
  }
\begin{verbatim}    
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

Note, the 'scale-step-theory' and the 'functional harmony analysis' use
different types of numberings: In a \has{}, all numbers refer to the root of the
chord. In a description based on the scale-step-theory, all added numbers refer
the bass tone represented by the Roman numeral. Therefore, if we describe an
inversion of a chord, we have to use different numberings:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < fis' a' d'' e''>1 
    < fis' a' d'' e''>1 
 }
  \addlyrics { 
    \markup \setHas "T" #'(("B"."3")("a"."8")("b"."9")) 
    \markup \setHas "III" #'(("a"."6")("b"."7")) 
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\hlyn\ does not support you to use the correct digits. It is your task
to adequately describe the chords with respect to the chosen theory.

Sometimes it is helpful, to expand your representation by a reinterpretation in
accordance to an enharmonic change. The parameters 'a', \ldots,'e' can be bound
to strings, not only to (altered) numbers. So, you are able also to create
constructs like this:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < fis' a' c'' es''>1 
 }
  \addlyrics { 
    \markup \setHas "T" #'(("B"."3")("a"."7♮")("b"."9♭⇒8♯")) 
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\subsection{Indicating the Supression of the Root Tone}

In the context of the scale-step-theory, the bass note is referred by the Roman
numeral which is inserted as a functional symbol. And each tone of the chord is
described by the distance to that bass tone (= by the number of the respectiv
intervall). Hence, the scale-step-theory does not have the need to indicate the
supression of the root tone.

In the context of the functional harmony theory the chord is referred by its
function. By default the respective symbol implies that the root is the bass
note and that the chord uses the third and the fifth. But in some cases you want
to indicate, that the chord does not use its root, but only the other
explitcitly or implicitly specified tones.

For indicating that the chord does not contain its root, insert the string
\texttt{("T"."x")} into the attribute list:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' fis'' a''>1 }
  \addlyrics { \markup \setHas "T" #'(("T"."x")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' fis'' a''>1 }
  \addlyrics { 
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "T" #'(("T"."x"))| }
\begin{verbatim}    
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

Note: Suppressing the root tone can be combined with the indication of a second
level function by adding the attribute \texttt{("T"."dx")} or
\texttt{("T"."xd")} into the attribute list.

\subsection{Indicating a Second Level Functions}

The functional harmony analysis also knows the second level function \acc{double
dominant}. \hlyn\ offers the opportunity to double all functional symbols for
creating any second level function symbol.

For indicating that the chord fulfills a second level function, insert the string
\texttt{("T"."d")} into the attribute list:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < e' gis' b'' e''>1 }
  \addlyrics { \markup \setHas "D" #'(("T"."d")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < e' gis' h'' e''>1 }
  \addlyrics { 
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "D" #'(("T"."d"))| }
\begin{verbatim}    
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

Note: Suppressing the root tone can be combined with the indication of a second
level function by using the attribute \texttt{("T"."dx")} or
\texttt{("T"."xd")}.

\subsection{Indicating Intermediary Chords}

In the functional harmony theory, by default each function refers to the
keynote: In a \acc{D Major} piece, \acc{A Major} is taken as dominant. In an
\acc{E Major} piece, \acc{A Major} is taken as subdominant. But sometimes, the
musicologist must indicate that a chord has a function with respect to the root
of the succeeding chord instead of being determined by the keynote. Such chords
are know as intermediary chords.

For indicating that a single chord is an intermediary chord and that its function
refers to the root of its successors, use the function \texttt{\textbackslash
setImHas} instead of \texttt{\textbackslash setHas}:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < e' gis' b' e''>1 < cis' a' e'' a''>1 }
  \addlyrics { 
    \markup \setImHas "D" #'() 
    \markup \setHas "D" #'(("B"."3")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
  < e' gis' b' e''>1 < cis' a' e'' a''>1  }
  \addlyrics { 
\end{verbatim}
{ \color{red} \verb|    \setImHas "D" #'() | }
\begin{verbatim}  
    \markup \setHas "D" #'(("B"."3")) }  
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize} 
 
\subsection{Indicating the Chord Context}

Using intermediary chords allow us to conclide, that the syntax of the
functional harmony theory is still not sufficiently elaborated and that
therefore the musicologists who use that theory depend on an underlying 'good
will' understanding of their readers. For understanding this statement take
a look at the following traditionally represented deceptive cadence:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < a' cis' e''>1 < fis' b' d'' >1 }
  \addlyrics { 
    \markup \setImHas "D" #'() 
    \markup \setHas "Tp" #'(("B"."5")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

The disadvantage of such a notation is, that the reader has to know, that A major
is the dominant of D major and the b minor is the relative key of D major and
that in this case therefore the row \texttt{(D) Tp} represents a deceptive
cadence.The harmonical analysis does not give him any hint.

It is better to explicate such implicit interpretations by using an expanded
language. \hlyn\ solves this issue by the opportunity to indicate the context of
a chord:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp 
    < a' cis' e''>1 < fis' b' d'' >1 }
  \addlyrics { 
    \markup \setImHas "D" #'(("C"."T")) 
    \markup \setHas "Tp" #'(("B"."5")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

Here you can conclude  to the deceptive cadence by using nothing more than the
definitions which the functional harmonyt theory uses. You do not need any
other knowledge:
\begin{itemize}
  \item Every dominant \texttt{D} leads to the tonic \texttt{T}.
  \item An intermediary chord \texttt{()} refers to the successor.
  \item In this case, the successor is not the expected tonic, but the relative tonic.
  \item Hence it is not a cadence, but a deceptive cadence \texttt{(D) Tp}
\end{itemize}

For indicating such a context you must expand the attribute list by the string
\texttt{("C"."YOUR\_CONTEXT")}.


\subsection{Indicating Chains of Intermediary Chords}

\subsection{Indicating the Context of Intermediary Chord Chains}

\subsection{Indicating Suspended and Passing Notes}

\subsection{Indicating Chords With Suspended and Passing Notes}

\subsection{Indicating Modulations}

\subsection{The 'Often-Used' Interface of 'harmonyli.ly'}

\section{Package Content}














% insert the nomenclature here

\input{bib/ncl.abbreviations.tex}
%\input{bib/ncl.journals}
\printnomenclature

% insert the bibliographical data here
\bibliography{bib/literature}

\end{document}
