% mycsrf cloak file
%
% (c) Karsten Reincke, Frankfurt a.M. 2010, 2011, ff.
%
% This file is licensed under the Creative Commons Attribution 3.0 Germany
% License (http://creativecommons.org/licenses/by/3.0/de/):
% For details see teh file LICENSE in the top directory
%
% select the document class
% S.26: [ 10pt|11pt|12pt onecolumn|twocolumn oneside|twoside notitlepage|titlepage final|draft
%         leqno fleqn openbib a4paper|a5paper|b5paper|letterpaper|legalpaper|executivepaper openrigth ]
% S.25: { article|report|book|letter ... }
%
% oder koma-skript S.10 + 16
\documentclass[
  DIV=calc,
  BCOR=5mm,
  12pt,
  headings=small,
  oneside,
  abstract=true,
  toc=bib,
  xcolor=dvipsnames,
  openany,
  english]{scrartcl}

%%% (1) general configurations %%%
\usepackage[utf8]{inputenc}

%%% (2) language specific configurations %%%
\usepackage[]{a4,babel}
\selectlanguage{english}

% package for improving the grey value and the line feed handling
\usepackage{microtype}

%language specific quoting signs
%default for language english is american style of quotes
%\usepackage[english=british]{csquotes}
\usepackage[english=american]{csquotes}

% jurabib configuration
\usepackage[see]{jurabib}
\bibliographystyle{jurabib}
\input{cfg/inc.jbib-cfg.tex}

% language specific hyphenation
\input{cfg/inc.hyphenations.tex}

%%% (3) layout page configuration %%%

% select the visible parts of a page
% S.31: { plain|empty|headings|myheadings }
%\pagestyle{myheadings}
\pagestyle{headings}

% select the wished style of page-numbering
% S.32: { arabic,roman,Roman,alph,Alph }
\pagenumbering{arabic}
\setcounter{page}{1}

% select the wished distances using the general setlength order:
% S.34 { baselineskip| parskip | parindent }
% - general no indent for paragraphs
\setlength{\parindent}{0pt}
\setlength{\parskip}{1.2ex plus 0.2ex minus 0.2ex}


%%% (4) general package activation %%%
%\usepackage{utopia}
%\usepackage{courier}
%\usepackage{avant}
\usepackage[dvips]{epsfig}

% graphic

\usepackage{array}
\usepackage{shadow}
\usepackage{fancybox}

\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{wasysym}

\usepackage{chngcntr}


%- start(footnote-configuration)

\deffootnote[1.5em]{1.5em}{1.5em}{\textsuperscript{\thefootnotemark)\ }}

% if document class = book: count footnotes from start to end
%\counterwithout{footnote}{chapter}
%- end(footnote-configuration)

% package for macking tables with broken lines
\usepackage{multirow}

%for using label as nameref
\usepackage{nameref}

%integrate nomenclature
\input{cfg/inc.ncl-meta.tex}

% depth of contents
\setcounter{secnumdepth}{5}
\setcounter{tocdepth}{5}

% Hyperlinks
\usepackage[breaklinks=true]{hyperref}
\hypersetup{bookmarks=true,breaklinks=true,colorlinks=true,citecolor=blue,draft=false}
\newcommand{\acc}[0]{\textit}
\newcommand{\ra}[0]{$\rightarrow$}
\newcommand{\lnka}[1]{\href{#1}{\texttt{#1}}}
\newcommand{\lnkb}[2]{\href{#1}{\texttt{#1} (RDL: #2)}}
\newcommand{\lnkr}[1]{\ra\ \href{#1}{\texttt{#1}}}

\newcommand{\com}[1]{\textit /* #1 */}

\usepackage{harmony}
\usepackage{musicography}

% Unfortunately musixtex and harmony? still uses outdated commands for
% establishing its own \bar command. Hence for enabling
% the use of musixtex we must 'redefine' these outdated commands:
\makeatletter
\DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
\DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
\DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
\DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
\DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
\DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
\DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
\makeatother

%\usepackage{bigfoot}
\usepackage{verbatimbox}

\newcommand{\hlyn}[0]{\textit{harmonyli.ly}}
\newcommand{\hlyf}[0]{\texttt{harmonyli.ly}}
\newcommand{\lily}[0]{\textit{LilyPond}}
\newcommand{\has}[1]{\textit{Harmony Analysis Symbol#1}}


\usepackage{longtable}
\usepackage{dirtree}

\begin{document}

%% use all entries of the bliography
\nocite{*}

%%-- start(titlepage)
\titlehead{Tutorial}
\subject{Release \input{inc.rel.tex}}
\title{harmonyli.ly}
\subtitle{Harmonical Analysis Symbols in LilyPond Scores}
\author{Karsten Reincke\input{cfg/inc.license-fn.tex}}

%thanks entry cannot be combined with license footnote
%\thanks{den Autoren von KOMA-Script und denen von Jurabib}

\maketitle
%%-- end(titlepage)

\begin{abstract}
\noindent \itshape
This tutorial describes how to create and embed \has{s}\ into scores. It
intends to be a handout for musicologists and other enthusiasts of harmony
analyses, who use \lily. It documents the usage of the library \hlyn\ by which
it can develop \acc{Riemann} symbols as well as symbols of the
\acc{scale-step-theory}). Due to the fact, that \hlyn\ as well as this \LaTeX\
based paper is published as open source software and that its sources are part
of the library \hlyn, it indirectly can also teach how to embed \lily\ snippets
into \LaTeX\ files.
\end{abstract}


\footnotesize
\tableofcontents

\normalsize

\section{Introduction}

In the beginning, there was the need to write a musicological work.

Actually, I should have had a good start: I knew already, that -- at least in
the humanities -- there is a big difference between the Anglo-American
scientific style\footcite[cf.][619ff]{ChMaStyle2010a} and the European resp.
German standard.\footcite[cf.][147ff]{Theisen2013a} I had already seen that it
was a bit tricky to use that style in \LaTeX. To close the gap that I had met, I
had developed a complete \LaTeX\ based environment for writing scientific
articles and books which fulfill the sophisticated requirements of the (German)
humanities in general and the standards of the musicology in
particular.\footcite[cf.][\nopage wp]{reincke2018a} I had published this tool as
open source software\footcite[cf.][\nopage wp]{reincke2018c} and described the
respective (working) style.\footcite[cf.][\nopage]{reincke2018b}

But -- unfortunately -- I still did not know, how to embed snippets of musical
scores into a \LaTeX\ file. Trawling through the web delivered a bulk of tools
and methods, but no manual and no tutorial, how to successfully combine which
tools for getting a usable working environment. Thus, I had to interrupt my
musicological work before I had started it. Previously, it was necessary to
investigate the situation for not backing the wrong horse. In the end, I had
written a complete analysis of the best way to embed musicological examples
into \LaTeX\ texts.\footcite[cf.][\nopage]{reincke2019c} And I had published the
respective sources als kind of open source
'software'.\footcite[cf.][\nopage]{reincke2019a}

A preliminary result of this investigation was, that we have three back-ends for
using musical notes in \LaTeX: We could use the style of \acc{ABC}-Notation and
would only be able to integrate very simple harmony analysis symbols into our
exemplifying score. Or we could use a combination of \acc{\LaTeX, Musix\TeX, and
harmony} which offered excellent and sophisticated results but enforced us, to
use the very complex and difficult typesetting language \acc{MusicTeX} without
being supported by any good (semi-)graphical Editor. Or we could use the well
established coding environment \acc{LilyPond} and its \LaTeX-integration tool
\acc{lilypondbook} together with at least two excellent semi-graphical Editors
like \acc{Frescobaldi} or \acc{Elysium}. Moreover, if we were willing to use
converters like \acc{music\-xml2ly}, we could also use the genuine graphic editor
\acc{MuseScore}. But then, we would again not be able to insert harmony
analysis symbols on a level which matches the state of the art and which was
fulfilled by the \LaTeX\ tool \acc{harmony}.\footnote{For a survey of the
existing backends \cite[cf.][19ff]{reincke2019c}. For a an outline of the
generally possible way to combine existing tools \cite[cf.][91f]{reincke2019c}.
And for the final result \cite[cf.][100f]{reincke2019c}. If you need more
information about the tools mentioned in this paragraph, have a look at the
respective chapters in \cite[cf.][\nopage et passim]{reincke2019c}}

At that point, I knew, what was possible. But I did not want to respect the
result. Using \acc{\LaTeX, Musix\TeX, and harmony} would decrease my
productivity in an unacceptable manner. So, I started a re-implementation of
\acc{harmony} for \acc{LilyPond} by using its LISP based language \acc{GUILE}
and the respective techniques for expanding this score edition system. I decided
to name it \acc{harmonyli.ly}, because this name would give credits to the
\LaTeX\ based idea generator \acc{harmony}\footcite[cf.][\nopage]{WegWeg2007a}
as well as to the intended target system \acc{LilyPond}\footcite[cf.][\nopage
wp]{LilyPond2018a}, which I had learned to love. My result worked. But its
appearance was not on the level I preferred to achieve.

So, I asked the \acc{LilyPond} community for feedback\footnote{\ra\
\lnka{https://lists.gnu.org/archive/html/lilypond-user/2019-10/msg00411.html}}.
I knew, that at that time I might have been a good programmar, an expert of
musical theory, and an adept of Free and Open Source Software and its spirit,
but I certainly was not familiar with the internals of \acc{LilyPond}, its
'biotope' of additional tools and its history. But at this point, a typical open
source success story started.

I got a lot of hints, for instance by Leo Correia de Verdier, Phil Holmes, Urs
Liska Thomas Morley, Mark Stephen Mrotek, Carl Sorensen, Saul Tobin, David
Wright. I was told that Klaus Blum had already written a first version of such a
tool and that it was published as Public Domain Software in the \acc{LilyPond
Snippet Repository}.\footcite[cf.][\nopage wp]{Blum2019a} So I took this
preliminary work, redesigned and expanded the interface, rewrote some functions
and added a lot of other code. But nevertheless, my library was a derivative
work of Klaus Blum's model. So -- and even if it had not been necessary from a
legal point of view --, I asked him whether he could accept that I was
re-engineering his work and that I was going to release the result under a
licensing construct, by which the user could choose the license he preferred,
either GPL or MIT. And to my great pleasure, Klaus Blum agreed with this
concept.\footnote{You will find the approving mail in the directory 'xtras' of
the harmonyli.ly sources. (\ra\
\lnka{https://github.com/kreincke/harmonyli.ly/tree/master/xtras}) Just as Klaus
Blum did, also \hlyn\ uses some examples offered by Neil Puttock for explaining
how to use text span engraver ( \ra\
\lnka{http://www.mail-archive.com/lilypond-user%40gnu.org/msg60732.html
} )
and which therefore fall under the same license as any other example code which
is offered by \lily. }

That was the way by which you now obtain three results, which should not be
undervalued:
\begin{itemize}
  \item With \hlyn, you get a technique to enrich your scores by
  harmony analysis symbols on a level, which is as expressive as it is required
  by the musicology and as beautiful as it necessary for not disturbing the
  excellent output of \acc{LilyPond}.
  \item You get \hlyn\ as open source software\footcite[cf.][\nopage wp]{ReinckeBlum2019a} together with a licensing, which is explicitly approved
  by the copyright holders Hans Blum and me, Karsten Reincke. Hence, you can be
  sure of really having got the rights you need to use \hlyn.
  \item You get a complete tutorial\footcite[cf.][\nopage wp]{Reincke2019b} which
  thoroughly explains
  \begin{itemize}
    \item how to generally install and integrate \hlyn\ into your work
    \item how to prepare your work for using \hlyn\ successfully
    \item how to create the particular \has{s}\ required by the musicology.
  \end{itemize}
\end{itemize}

And the way of learning how to use \hlyn\ starts now:

\section{Installation \& Integration}
\begin{itemize}
  \item Clone the \hlyn\ repository or download and extract the \hlyn\ zip
  archive by using the respective (github)
  commands.\footnote{\lnkr{https://github.com/kreincke/harmonyli.ly}}
  \item Copy the file \hlyf\ somewhere into your file system.
  \item Insert the command \texttt{\textbackslash include
  "YOUR\_PATH\_TO/harmonyli.ly"} into
  your \lily\ file above the first \texttt{score\{\ldots\}} section.
  \item Expand your \texttt{layout\{\ldots\}} section by the line
   \texttt{\textbackslash context\{\textbackslash Lyrics \textbackslash consists
   "Text\_spanner\_engraver"\}}.
\end{itemize}

\section{Application \& Utilization}

\hlyn\ uses the lyrics technique of \lily\ to embed the \has{s} into the \lily\
score. The benefit is that \lily\ itself aligns the music notes and the
respective analysis symbols: it prevents horizontal overlaps, if a \has\ is
longer than the respective note.

As a little disadvantage \hlyn\ needs a dedicated voice to which the row of
\has{s} can be bound. After having set up your \lily\ file as described above
you have three opportunities to fulfill this condition:

\subsection{Binding \has{s} to a Real Voice}

Linking \has{s} to a really used staff is straight forward:

\subsubsection{Example}
\begin{center}
\begin{lilypond}

\version "2.18.2"

\header { tagline = "" }
\include "lilypond/harmonyli.ly"

\score {
  \new StaffGroup {
    \time 4/4
    <<
      \new Staff {
        \relative d' {
          \clef "treble"
          \key d \major
          \stemUp
          < fis a d>2 < fis a dis> < g b e> < g b eis>2 |
          < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
        }
      }
      \new Staff {
        \relative d {
          \clef "bass"
          \key d \major
          \stemDown
          d2 b d cis  |
          d b d4 cis4 d2 \bar "||"
        }
      }
      \addlyrics {
          \markup \setHas "T" #'(("C"."D")("fr" . " "))
          \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
          \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
          \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")("c" . "♭9>♯8")("fr" . " "))
          \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " "))
          \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")("fr" . " "))

          \initTextSpan "  "
          \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
          \startTextSpan
          \markup \expZoomRow #'(("a"."3")("fr" . " "))
          \stopTextSpan

          \markup \setHas "T" #'(("fr" . " "))
        }
    >>
  }
  \layout {
    \context {
      \Lyrics
      \consists "Text_spanner_engraver"
    }
  }
  \midi {}
}
\end{lilypond}
\end{center}

\subsubsection{Code}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "harmonyli.ly"
\score {
  \new StaffGroup {
    \time 4/4
    <<
      \new Staff {
        \relative d' {
          \clef "treble" \key d \major \stemUp
          < fis a d>2 < fis a dis> < g b e> < g b eis>2 |
          < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
      } }

      \new Staff {
        \relative d {
          \clef "bass" \key d \major \stemDown
          d2 b d cis  | d b d4 cis4 d2 \bar "||"
      } }

      \addlyrics {
          \markup \setHas "T" #'(("C"."D")("fr" . " "))
          \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
          \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
          \markup \setHas "D" #'(("T"."x")("B"."3")
                                ("a" . "5")("b" . "7")("c" . "-9>+8")("fr" . " "))
          \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " "))
          \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                                ("fr" . " "))
          \initTextSpan "   "
          \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
          \startTextSpan
          \markup \expZoomRow #'(("a"."3")("fr" . " "))
          \stopTextSpan
          \markup \setHas "T" #'(("fr" . " "))
        }
    >>
  }
  \layout { \context{\Lyrics\consists "Text_spanner_engraver"} }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

\subsubsection{Description}

This example contains a descant staff and a bass voice. To the letter one, it
appends the section \texttt{addlyrics}, which contains for each note of the bass
voice one specific \has. If you do not want to use such a 1:1 relation between
notes and \has{s}, you can use one of the other methods.

\subsection{Binding \has{s} to a Hidden Voice}
\label{HiddenVoice}

Linking the \has{s} to an invisible voice is a bit tricky: First, you must
design your staff as a staff with several voices. Then you inscribe a (mostly
very deep) 'artificial' voice into that staff and bind the symbols to that
'artificial' voice.\footnote{For demonstrating this option, we have colored the
'hidden' voice. If you change the string \texttt{new Voice = "AnalysisSubline"}
into \texttt{new NullVoice = "AnalysisSubline"}, the voice becomes really
invisble.}

This method is good for a score with a large amplitude of pitches (as some
romantic piano pieces use): by applying the method you can enforce a larger
distance between the used notes and the \has{s}.

\subsubsection{Example}
\begin{center}
\begin{lilypond}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing, basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 |
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythmHidden =
\relative c, {
  \clef bass \stemDown \global
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "♭9>♯8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " "))
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }
      { <<
          \descant
        >>
      }
      \new Staff = lower
      \new Voice = "Musical Bass"
      \with { printPartCombineTexts = ##f }
      { <<
          \bass
          % change "Voice" to "NullVoice" to make analyze voice unvisible:
          \new NullVoice = "AnalysisSubline" {\shiftOff  \hasRhythmHidden}
          \new Lyrics \lyricsto "AnalysisSubline" \hasSymbols
        >>
      }
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}
\end{lilypond}
\end{center}

\subsubsection{Code}
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing, basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 |
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythmHidden =
\relative c, {
  \clef bass \stemDown \global
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "-9>+8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " "))
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }
      { <<
          \descant
        >>
      }
      \new Staff = lower
      \new Voice = "Musical Bass"
      \with { printPartCombineTexts = ##f }
      { <<
          \bass
          % change "Voice" to "NullVoice" to make analyze voice unvisible:
          \new Voice = "AnalysisSubline" {\shiftOff  \hasRhythmHidden}
          \new Lyrics \lyricsto "AnalysisSubline" \hasSymbols
        >>
      }
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}
\end{verbatim}
\end{scriptsize}

\subsubsection{Description}

This example uses four voices in four variables: the right-hand voice
(\texttt{= descant}), the left-hand voice (\texttt{= bass)}, the hidden voice
defining the rhythmical granularity of the analysis (\texttt{= hasRhythmHidden})
and the respective stream of \has{s} (\texttt{= hasSymbols}). Inside of the
section \texttt{\textbackslash score{\ldots}} the 'sounding' bass and the
'virtual' voice \acc{AnalysisSubline} are inserted into the left-hand staff. And
the stream of \has{s} \texttt{\textbackslash hasSymbols} is bound to that
'virtual' voice by using the command \texttt{\textbackslash lyristico} and a
reference by name.\footnote{Due to fact, that the \has{s} appear under the
analysis staff, it sometimes happens, that next part of your score (after the
system 'linefeed') is visually not sufficiently separated from the preceding
system. That aggravates to read the score fluently. For increasing or decreasing
the distance between the system lines, you can play around with the values
inserted into the section \texttt{\textbackslash page\{\ldots\}}}


\subsection{Binding \has{s} to a Dedicated 'Analysis' Staff}
\label{BindingToDedicatedAnalysisStaff}

Binding the \has{s} to a specific \acc{analysis} staff is straight forward
again: you must create a voice in a special staff which only represents the
rhythm.

This method is good for scores with many staves (like those of symphonies etc.):
it simplifies to ignore the harmonically irrelevant passing notes.

\subsubsection{Example}
\begin{center}
\begin{lilypond}

\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing, basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 |
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythm = \relative c {
  \stemDown \global
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "♭9>♯8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " "))
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }{\descant}
      \new Staff = lower
      \with { printPartCombineTexts = ##f }{\bass}
    >>
    \new RhythmicStaff = analysis
    \with { printPartCombineTexts = ##f }
    {
      <<
      \new Voice = "AnalysisLine" { \hasRhythm}
      \new Lyrics \lyricsto "AnalysisLine" \hasSymbols
      >>
    }
  >>

  \layout{ \context{\Lyrics\consists "Text_spanner_engraver"}}
}

\end{lilypond}
\end{center}


\subsubsection{Code}
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\paper {
  indent = 0
  ragged-right = ##f
  system-system-spacing, basic-distance = #20
  score-system-spacing =
    #'((basic-distance . 12)
       (minimum-distance . 6)
       (padding . 1)
       (stretchability . 12))
}

\header { tagline = "" }

global  = { \key d \major  \time 4/4}

descant = \relative c' {
  \clef treble \stemUp \global
  < fis a d>2 < fis a dis> < g b e> < g b eis>2 |
  < fis b fis'>2 < b e gis> < a e' g!> < a d fis>2 \bar "||"
}

bass = \relative c {
  \clef bass \stemNeutral \global
  d2 b d cis  | d b d4 cis4 d2 \bar "||"
}

hasRhythm = \relative c {
  \stemDown \global
  c2 c | c c | c c | c4 c4 c2 \bar "||"
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "T" #'(("C"."D")("fr" . " "))
  \markup \setImHas "D" #'(("B"."1")("a" . "7")("fr" . " "))
  \markup \setHas "Sp" #'(("B"."7")("a" . "7")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."x")("B"."3")("a" . "5")("b" . "7")
                          ("c" . "-9>+8")("fr" . " "))
  \markup \setHas "Tp" #'(("B"."3")("fl" . " ")("fr" . " "))
  \markup \setHas "D" #'(("T"."d")("B"."5")("a" . "7")("b" . "8")
                          ("fr" . " "))
  \initTextSpan "    "
  \markup \openZoomRow "D" #'(("a"."4")("fl" . " "))
  \startTextSpan
  \markup \expZoomRow #'(("a"."3")("fr" . " "))
  \stopTextSpan
  \markup \setHas "T" #'(("fr" . " "))
}

\score {
  <<
    \new GrandStaff <<
      \new Staff = upper
      \with { printPartCombineTexts = ##f }{\descant}
      \new Staff = lower
      \with { printPartCombineTexts = ##f }{\bass}
    >>
    \new RhythmicStaff = analysis
    \with { printPartCombineTexts = ##f }
    {
      <<
      \new Voice = "AnalysisLine" { \hasRhythm}
      \new Lyrics \lyricsto "AnalysisLine" \hasSymbols
      >>
    }
  >>

  \layout{ \context{\Lyrics\consists "Text_spanner_engraver"}}
}

\end{verbatim}
\end{scriptsize}

\subsubsection{Description}

In general, this third example follows the ideas of the second. But it does not
inscribe the sounding bass and the 'virtual' analysis voice into the same staff.
Instead of this, each of them gets its own staff. And again, the stream of
\has{s} is linked to the analysis voice \acc{hasRhythm} by the command
\texttt{\textbackslash lyristico} and a name reference.

\section{\has{s}}

After having generally explained how to integrate and use \hlyn, we can now
discuss, how particular \has{s}\ are generated by \hlyn\ commands. For that
purpose, \hlyn\ offers two interfaces: the basic \hlyn\ functions and some
often used instantiations\footnote{\ra\ FAQ p. \pageref{FAQ}}. This chapter describes the general interface:

\subsection{The basic \hlyn-functions}
The basic interface of \hlyn\ contains nine functions:

\begin{longtable}
  { r
    >{\raggedleft\hspace{0pt}}p{4cm}
    c
    >{\raggedright\hspace{0pt}}p{8cm}
   }

(01) & \textbf{setHas} & \ra & inserts a \has{}.
\tabularnewline
(02) & \textbf{setImHas} & \ra & inserts an \acc{Intermediary \has{}} whose
function refers to the root of the succeding chord instead of being determined
by the keynote.
\tabularnewline
(03) & \textbf{setRfHas} & \ra & inserts a \acc{Reframing \has{}} as it is
required by modulations: the function of a chord -- determined by the current
tonal center -- is reinterpreted as a function in the context of the next tonal
center
\tabularnewline
(04) & \textbf{openImRow} & \ra & starts an intermediary chain of \has{s}\
where each chord of the chain refers to the root of chord which follows the chain
\tabularnewline
(05) & \textbf{closeImRow} & \ra & closes an intermediary chain of \has{s}\
and indicates, that the root of the directly succeding chord is the tonal
center of that chain
\tabularnewline
(06) & \textbf{openZoomRow} & \ra & starts the zoom into a \has{} which shall
cover suspended or passing notes
\tabularnewline
(07) & \textbf{expZoomRow} & \ra & expands an opened \has{} by a description of
suspended or passing notes which do not modify the current harmonic function
\tabularnewline
(08) & \textbf{openImZoomRow}  & \ra & starts the zoom into an intermediary
\has{} which shall cover suspended or passing notes
\tabularnewline
(09) & \textbf{closeImZoomRow} & \ra &  closes the zoom into a intermediary
\has{} which covers suspended or passing notes
\tabularnewline

\end{longtable}


\subsection{How to combine these \hlyn-functions correctly}

In accordance with the following eBNF
grammar\footnote{for details \ra\
\lnka{https://en.wikipedia.org/wiki/Extended\_Backus\%E2\%80\%93Naur\_form}
and/or \lnka{https://en.wikipedia.org/wiki/Backus-Naur\_form}
}, you can embed five types of sub rows
into your stream of \has{s}\footnote{Note: \hlyn\ intends to be complete, but
not correct. This -- may be surprising -- statement must be explained: In
computer sciences, one discusses the correctness and the completeness of a
process for deriving syntagms by using a semantic interpretation of each
derivable syntagm. The construct (language and process) is \textbf{complete}, if
for any intended real-world object a syntagm can be derived which refers to that
real world element. And the construct is \textbf{correct} if each derivable
syntagm refers to a real world object. For human beings in general and
musicologist in particular it is more important to use a \textbf{complete}
language (of \has{s}) than using a correct language: We want to know that
we can express whatever we want to express, because our language is complete.
And we can avoid wrong / meaningless syntagms manually so that the fact, that
our language is not correct (in the sense of computer languages) does not
matter. Therefore, we want to say that
\begin{itemize}
  \item \textbf{all} 'sub rows' of \has{s} which are necessary to describe the
  harmonic relationships of real world chords must be formable by \hlyn.
  \item \textbf{not all} 'sub rows' of \has{s} which can be generated by \hlyn\
  necessarily describe possible chord chains.
\end{itemize}
A last remark: If one had a correct and complete language for describing streams
of harmonic chords, then one would have a complete theory of harmonization
that no longer needs the help of 'unrepresented human knowledge'.
Delivering such a theory is far beyond the target of \hlyn.
}:

\begin{verbatim}
HasStream ::- ( setHas | setImHas | setRfHas |
                openImRow, setHas*, closeImRow |
                openZoomRow, expZoomRow+ |
                openImZoomRow, expZoomRow*, closeImZoomRow )+
\end{verbatim}

These production rules inidicate, that
\begin{itemize}
  \item you may use the 'normal' \has{s}\ -- may it be a simple \has, an
  intermediary \has, or a reframing \has\ -- without having to consider its
  predecessors or successors
  \item you must close an opened intermediate row and between the opening and
  the closing element of that chain you can insert as many normal \has{s} as you
  want
  \item you need not explicitly to close an opened zoom
\end{itemize}


\subsection{The Syntax of a \has{}}

Typical \has{s}\ look like these:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a' d''>1
    < b g' d'' e''>1
    < cis' e' a' e''>1
    < cis' g' b' e''>1
    < d' gis' b' e''>1
    < d' gis' b' e''>1
    < cis' g' a' e''>1
    < d' fis' a' d''>1
  }
  \addlyrics {
    \markup \setHas "T" #'()
    \markup \setHas "S" #'(("B"."3")("a"."5")("b"."6"))
    \markup \setHas "D" #'(("B"."3"))
    \markup \setHas "D" #'(("T"."x")("B"."3")("S"."5")("a"."7")("b"."9"))
    \markup \setHas "D" #'(("T"."d")("B"."7")("a"."7")("b"."8"))
    \markup \setImHas "D" #'(("B"."7")("a"."7")("b"."8"))
    \markup \setHas "D" #'(("B"."3")("a"."7")("b"."8"))
    \markup \setHas "T" #'()
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

They are created by different \hlyn\ functions, which -- nevertheless -- take
the same kind of parameters\footnote{except \texttt{setRfHas} and
\texttt{expZoomRow}}: The function symbol is obligatory and specified as a string
argument. The other parameters are optional and handed over in a list of
attributes. Let \hlyn\ itself visualize the structure of a \has{}:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
   < fis' a' b' d'' e''>1 }
  \addlyrics {
    \markup
      \setHas "Functionsymbol"
        #'( ("B"."B ::- Bassnote")
            ("S"."S ::- Soprannote")
            ("C"."C ::- Context")
            ("a"."a ::- first modifier")
            ("b"."b ::- second modifier")
            ("c"."c ::- third modifier")
            ("d"."d ::- fourth modifier")
            ("e"."e ::- fifth modifier")
            ("fl"."fl ::- präfix ")
            ("fr"." fr ::- suffix")
        ) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

The general syntax to specify such a \has{}\ is this:

\begin{scriptsize}
\begin{verbatim}
...
  \addlyrics {
    ...
    \setHas
      "T"             ; the function symbol
      #               ; indicator to read the following syntagm as scheme term
      `               ; indicator to evalute the syntagm and insert the result
      (               ; start of the syntagm 'attribute list'
        ("B" . "3")   ; insert a bass note 3
        ("S" . "8")   ; insert a sopran note 8
        ("C" ."D Major") ; explicate the keynote as reference
        ("a" . "3")   ; insert the lowest number beside the functional symbol
        ("b" . "5")   ; insert the second number beside the functional symbol
        ("c" . "6")   ; insert the third number beside the functional symbol
        ("d" . "8")   ; insert the fourth number beside the functional symbol
        ("e" . "9")   ; insert the fifth number beside the functional symbol
        ("fl" ."any-prefix ") ; insert a prefix before the harmony analysis symbol
        ("fr" ." any-suffix") ; insert a suffix after the harmony analysis symbol
      )               ; end of the attribute list
    ...
  }
\end{verbatim}
\end{scriptsize}

In general, you can skip the attributes which you do not want to use. And you
can insert the attributes you want to use in any succession you prefer.
Howsoever, the presented example would create the following output:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
  < fis' a' b' d'' e''>1 }
  \addlyrics {
    \markup
      \setHas "T"
        #'( ("B" . "3")
            ("S" . "9")
            ("C" ."D Major")
            ("a" . "3")
            ("b" . "5")
            ("c" . "6")
            ("d" . "8")
            ("e" . "9")
            ("fl" ."any-prefix ")
            ("fr" ." any-suffix")
        ) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

For modifying this example\footnote{Later, we will explicitly describe the
purpose of this feature 'explicating the context'. Up to that point we will
ignore this opportunity in our examples.} into an intermediary chord, you only
must replace the function \texttt{\textbackslash setHas} by the function
\texttt{\textbackslash setImHas}. As a result you will get this:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
  < fis' a' b' d'' e''>1 }
  \addlyrics {
    \markup
      \setImHas "T"
        #'( ("B" . "3")
            ("S" . "9")
            ("a" . "3")
            ("b" . "5")
            ("c" . "6")
            ("d" . "8")
            ("e" . "9")
            ("fl" ."any-prefix ")
            ("fr" ." any-suffix")
        ) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

If you want to cross out the functional symbol for indicating that the root is
not part of the chord or if you want to double the functional symbol for
indicating that it is a second-level function or if you want to indicate both
aspects, simply add the attribute \verb|("T"."x")| respectively
\verb|("T"."d")| respectively \verb|("T"."dx")| or \verb|("T"."xd")|:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key c \major \time 4/4 \stemUp
  < fis' a' b' c'' e''>1
  < fis' a' b' c'' e''>1
  < fis' a' b' c'' e''>1 }
  \addlyrics {
    \markup \setHas "D"
        #'( ("T" . "x")("B" . "3")("S" . "9")
            ("a" . "3")("b" . "5")("c" . "6")("d" . "7")("e" . "9"))
    \markup \setHas "D"
        #'( ("T" . "d")("B" . "3")("S" . "9")
            ("a" . "3")("b" . "5")("c" . "6")("d" . "7")("e" . "9"))
    \markup \setHas "D"
        #'( ("T" . "xd")("B" . "3")("S" . "9")
            ("a" . "3")("b" . "5")("c" . "6")("d" . "7")("e" . "9"))
        }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\subsection{Using \hlyn\ for scale step symbols}

For demoing that you can use \hlyn\ also, if you want to describe the music by
the elements of scale step theory, let us shortly convert the given example into
that format:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a' d''>1
    < b g' d'' e''>1
    < cis' e' a' e''>1
    < cis' g' b' e''>1
    < d' gis' b' e''>1
    < d' gis' b' e''>1
    < cis' g' a' e''>1
    < d' fis' a' d''>1
  }
  \addlyrics {
    \markup \setHas "I" #'()
    \markup \setHas "VI" #'(("a"."3")("b"."4")("c"."6"))
    \markup \setHas "VII" #'(("a"."6"))
    \markup \setHas "VII" #'(("a"."5")("b"."7"))
    \markup \setHas "I" #'(("a"."2")("b"."♯4")("c"."6"))
    \markup \setHas "I" #'(("a"."2")("b"."♯4")("c"."6"))
    \markup \setHas "VII" #'(("a"."7")("b"."8"))
    \markup \setHas "I" #'()
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\section{\has{s}: Simple and Complex Examples}

After having explained the general methods to create a \has{}, we can now show
how one can fulfill specific musical needs by these techniques:

\subsection{Inserting a Function Symbol}

The majority of Anglo-American musicologists use something like the
'scale-step-theory' by which each tone of the scale and the respective chord is
referred by the respective number (represented by a Roman numeral).
Alternatively one can use the functional (harmony) theory by which the chords of
a scale are referred by their harmonious functions (represented by
characters).\footcite[for dedails cf.][\nopage wp]{wpFunctionTheory2019a} Both
methods can be expressed by \hlyn: Insert the respective symbol as the first
argument of the \hlyn\ basic functions. If you don't need any additional
specifier, add at least an empty attribution list \texttt{\#'()}:

\begin{center}
\begin{lilypond}

\version "2.18.2"

\header { tagline = "" }
\include "lilypond/harmonyli.ly"

\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a'>1
    < e' g' b' >1
    < fis' a' cis'' >1
    < g' b' d'' >1
    < a' cis'' e'' >1
    < b' d'' fis'' >1
    < cis'' e'' g'' >1
  }
  \addlyrics {
    \markup \setHas "I" #'()
    \markup \setHas "II" #'()
    \markup \setHas "III" #'()
    \markup \setHas "IV" #'()
    \markup \setHas "V" #'()
    \markup \setHas "VI" #'()
    \markup \setHas "VII" #'()
  }
  \addlyrics {
    \markup \setHas "T" #'()
    \markup \setHas "Sp" #'()
    \markup \setHas "Tg/Dp" #'()
    \markup \setHas "S" #'()
    \markup \setHas "D" #'()
    \markup \setHas "Tp/Sg" #'()
    \markup \setHas "D" #'(("T"."x")("a" . "7"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}

\end{lilypond}
\end{center}
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"

\header { tagline = "" }
\include "lilypond/harmonyli.ly"

\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < d' fis' a'>1
    < e' g' b' >1
    < fis' a' cis'' >1
    < g' b' d'' >1
    < a' cis'' e'' >1
    < b' d'' fis'' >1
    < cis'' e'' g'' >1
  }
  \addlyrics {
    \markup \setHas "I" #'()
    \markup \setHas "II" #'()
    \markup \setHas "III" #'()
    \markup \setHas "IV" #'()
    \markup \setHas "V" #'()
    \markup \setHas "VI" #'()
    \markup \setHas "VII" #'()
  }
  \addlyrics {
    \markup \setHas "T" #'()
    \markup \setHas "Sp" #'()
    \markup \setHas "Tg/Dp" #'()
    \markup \setHas "S" #'()
    \markup \setHas "D" #'()
    \markup \setHas "Tp/Sg" #'()
    \markup \setHas "D" #'(("T"."x")("a" . "7"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating a Bass Note}

In the context of the scale-step-theory, the bass note is referred by the Roman
numeral which is inserted as a functional symbol. Hence, the  scale-step-theory
does not have the need to additionally indicate the bass note.

In the context of the functional harmony theory, the chord is referred by its
function. By default, the respective symbol implies that the root is the bass
note and that the chord uses the third and the fifth. Therefore, the bass note
of a described chord is only revealed if it is not the root of the chord. For
indicating the bass note expand the attribute list by the
string \texttt{("B"."YOUR\_NUMBER")}:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' d'' a''>1 }
  \addlyrics { \markup \setHas "T" #'(("B"."3")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' d'' a''>1 }
  \addlyrics {
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "T" #'(("B"."3"))| }
\begin{verbatim}
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating a Treble Note}

Sometimes, a musicologist wants to explicitly specify the highest tone of a
chord. For indicating the 'soprano' note expand the attribute list by the string
\texttt{("S"."YOUR\_NUMBER")}:
\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < d' a' d'' fis''>1 }
  \addlyrics { \markup \setHas "T" #'(("S"."3")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' d'' a''>1 }
  \addlyrics {
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "T" #'(("S"."3"))| }
\begin{verbatim}
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating Descant Tones}\label{IndicateDescantTones}

In accordance with the method for writing a basso continuo, both theories
explicitly display the numbers of those chord tones which shall be used, but
which are not covered by the default rule 'take 1+3+5+8'. And with respect to
the other composition rule 'by default combine thirds' each number implictly
suppresses its predecessor and successor. Hence, if the chord contains a second,
the two respective adjacent numbers must be revealed.

\hlyn\ allows you to add up to five deviating tones by inserting the strings
\texttt{("a"."YOUR\_NUMBER")}, \ldots, \texttt{("e"."YOUR\_NUMBER")} into the
attribute list. Additionally, these numbers can be altered by using the standard
UTF8 / Unicode signs \{\musDoubleFlat , \musFlat , \musNatural , \musSharp ,
\musDoubleSharp \}\footnote{We use the \LaTeX\ command
 \texttt{\textbackslash verbatim} for showing the \lily\ code which creates the
 example. Unfortunately, we can not use special Unicode signs in these sections.
As a substitute we use \texttt{+} for \musSharp, \texttt{-} for \musFlat\ and
 \texttt{*} for \musNatural. }:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < a' c'' es'' f'' g'' bis''>1
  }
  \addlyrics {
    \markup \setHas "D" #'(("a"."3♮")("b"."5♭")("c"."6♮")("d"."7")("e"."9♯"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < a' c'' es'' f'' g'' bis''>1
  }
  \addlyrics {
  \end{verbatim}
  { \color{red} \verb|    \markup \setHas "D" #'(("a"."3*")("b"."5-")("c"."6*")("d"."7")("e"."9+")) |
  }
\begin{verbatim}
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

Note, the 'scale-step-theory' and the 'functional harmony analysis' use
different types of numberings: In a \has{}, all numbers refer to the root of the
chord. In a description based on the scale-step-theory, all added numbers refer
to the bass tone represented by the Roman numeral. Therefore, if we describe an
inversion of a chord, we have to use different numberings:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < fis' a' d'' e''>1
    < fis' a' d'' e''>1
 }
  \addlyrics {
    \markup \setHas "T" #'(("B"."3")("a"."8")("b"."9"))
    \markup \setHas "III" #'(("a"."6")("b"."7"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\hlyn\ does not support you to use the correct digits. It is your task
to adequately describe the chords with respect to the chosen theory.

Sometimes it is helpful, to expand your representation by a reinterpretation in
accordance with an enharmonic change. The parameters 'a', \ldots,'e' can be bound
to strings, not only to (altered) numbers. So, you are able also to create
constructs like this:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < fis' a' c'' es''>1
 }
  \addlyrics {
    \markup \setHas "T" #'(("B"."3")("a"."7♮")("b"."9♭⇒8♯"))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\subsection{Indicating the Supression of the Root Tone}\label{SupressRootTone}

In the context of the scale-step-theory, the bass note is referred by the Roman
numeral which is inserted as a functional symbol. And each tone of the chord is
described by the distance to that bass tone (= by the number of the respective
interval). Hence, the scale-step-theory does not have the need to indicate the
suppression of the root tone.

In the context of the functional harmony theory, the chord is referred by its
function. By default, the respective symbol implies that the root is the bass
note and that the chord uses the third and the fifth. But in some cases, you want
to indicate, that the chord does not use its root, but only the other
explicitly or implicitly specified tones.

For indicating that the chord does not contain its root, insert the string
\texttt{("T"."x")} into the attribute list:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' fis'' a''>1 }
  \addlyrics { \markup \setHas "T" #'(("T"."x")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < fis' a' fis'' a''>1 }
  \addlyrics {
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "T" #'(("T"."x"))| }
\begin{verbatim}
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

Note: Suppressing the root tone can be combined with the indication of a
second-level function by adding the attribute \texttt{("T"."dx")} or
\texttt{("T"."xd")} into the attribute list.

\subsection{Indicating Suppressed Chord Tones}

The \acc{Scale Step Theory} -- as well as the \acc{Functional Harmony Theory} --
uses some underlying rules for completing the chord: By default a tone of a
chord suppresses the usage of the tones next to him. So, if one wants to
indicate that a chord contains adjacent tones -- as for example the third and
the fourth --, then one has explicitly to mention both tones in the harmonical
representation. By default - if nothing else is given than the root / bass tone
-- the third, the fifth and the eight are added to the chord. In case of the
\acc{Scale Step Theory} these intervals refer to the given bass tone. In case of
the \acc{Functional Harmony Theory} they refer to the root tone of the chord
indicated by the functional \has{}.

\hlyn\ allows to separately
\acc{indicate descant tones}\footnote{\ra\ p.\pageref{IndicateDescantTones}}
to enable its users to fulfill these rules. But sometimes it is necessary to
overwrite these rules by stating that a tone which normally would have been to
added in reality is \acc{NOT} used: For \acc{supressing the root of a chord} we
have already descibed the resprective \hlyn\ function\footnote{\ra\
p.\pageref{SupressRootTone}}. So, we still must explain how one can indicate
that one of the descant tones is {NOT} used:

For this purpose, one inserts a \acc{Not-Used-Number-List} into the list of
features. It takes the identifier \acc{n} and a list of 'number positions'
\verb|"a"| \ldots \verb|"e"| . As result, the evaluating function crosses out
the content of each position mentioned in that list. If one wanted to cross out
each tone number mentioned in the chord representation, one would have to add
the syntagm \verb|("n" . ("a" "b" "c" "d" "e"))|. A more practically relevant
example could be this:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    <a' e'' g'' bes''>1
  }
  \addlyrics {
    \markup \setHas "D" #'(("a"."3")("b"."7")("c"."8")("d"."9♭") ("n" . ("a" "c")))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    <a' e'' g'' bes''>1
  }
  \addlyrics {
    \markup \setHas "D" #'(("a"."3")("b"."7")("c"."8")("d"."9-") ("n" . ("a" "c")))
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating a Second Level Functions}

The functional harmony analysis also knows the second-level function \acc{double
dominant}. \hlyn\ offers the opportunity to double all functional symbols for
creating any second-level function symbol.

For indicating that the chord fulfills a second-level function, insert the string
\texttt{("T"."d")} into the attribute list:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < e' gis' b'' e''>1 }
  \addlyrics { \markup \setHas "D" #'(("T"."d")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp < e' gis' h'' e''>1 }
  \addlyrics {
\end{verbatim}
{ \color{red} \verb|    \markup \setHas "D" #'(("T"."d"))| }
\begin{verbatim}
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

Note: Suppressing the root tone can be combined with the indication of a
second-level function by using the attribute \texttt{("T"."dx")} or
\texttt{("T"."xd")}.

\subsection{Indicating Intermediary Chords}

In the functional harmony theory, by default each function refers to the
keynote: In a \acc{D Major} piece, \acc{A Major} is taken as dominant. In an
\acc{E Major} piece, \acc{A Major} is taken as subdominant. But sometimes, the
musicologist must indicate that a chord has a function with respect to the root
of the succeeding chord instead of being determined by the keynote. Such chords
are known as intermediary chords.

For indicating that a single chord is an intermediary chord and that its function
refers to the root of its successors, use the function \texttt{\textbackslash
setImHas} instead of \texttt{\textbackslash setHas}:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < e' gis' b' e''>1 < cis' a' e'' a''>1 }
  \addlyrics {
    \markup \setImHas "D" #'()
    \markup \setHas "D" #'(("B"."3")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
  < e' gis' b' e''>1 < cis' a' e'' a''>1  }
  \addlyrics {
\end{verbatim}
{ \color{red} \verb|    \setImHas "D" #'() | }
\begin{verbatim}
    \markup \setHas "D" #'(("B"."3")) }
  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}
\end{verbatim}
\end{scriptsize}

\subsection{Indicating the Chord Context}

The common use of intermediary chords leads attentive musicologists to the
conclusion, that the syntax of the functional harmony theory is still not
sufficiently designed. They know that their analyses sometimes, unfortunately,
depend on an underlying 'goodwill' understanding of their readers. Let us prove
this statement by a look at the following traditionally represented deceptive
cadence:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < a' cis' e''>1 < fis' b' d'' >1 }
  \addlyrics {
    \markup \setImHas "D" #'()
    \markup \setHas "Tp" #'(("B"."5")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

The disadvantage of such a notation is, that the reader has to know, that A
major is the dominant of D major and the b minor is the relative key of D major
and that in this case, therefore, the row \texttt{(D) Tp} represents a deceptive
cadence. The representation of the harmonic analysis itself does not give him
any hint. But if we found the string \texttt{(D[T]) Tp} indicating the context
of the frist chord, we would have a clear syntactically based representation:
The dominant of the tonic is followed by the relative to the tonic and that it
is -- by definition -- a deceptive cadence:

\begin{center}
\begin{lilypond}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    < a' cis' e''>1 < fis' b' d'' >1 }
  \addlyrics {
    \markup \setImHas "D" #'(("C"."T"))
    \markup \setHas "Tp" #'(("B"."5")) }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\begin{itemize}
  \item Every dominant \texttt{D} leads to its tonic \texttt{T}.
  \item All intermediary chords \texttt{()} refer to their successors.
  \item Here, the successor is not the expected tonic, but the relative tonic.
  \item Hence it is not a cadence, but a deceptive cadence \texttt{(D) Tp}
\end{itemize}

For indicating the context of a specific function you must expand the attribute
list by the string \texttt{("C"."YOUR\_CONTEXT")}. The context can either be
another function or the root of a key.\footnote{Using the square brackets as an
indicator for the context follows de la Motte who also saw the need to exemplify
a local tonal center as something like the context of the interpretation.
(\cite[cf.][144 et passim]{Delamotte2011a})}


\subsection{Indicating Intermediary Chains of Chords}

Sometimes, the musicologist has not only to indicate a single intermediary
chord, but an intermediary chain of chords where each chord of this chain
refers to the successor of the chain.

For deriving this need, let us first present an example and its traditional
straight forward analysis:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 <  d' fis' a' c''>1  < e' g' b'>
    < e' g' c'' g''>1 < d' a' c'' fis''>1 < b g' d'' g''>1 }
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \setHas "T" #'(("a"."♮7"))
    \markup \setHas "Sp" #'()
    \markup \setHas "S" #'(("T"."d")("B"."3"))
    \markup \setHas "T" #'(("a"."♮7"))
    \markup \setHas "S" #'(("B"."3"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

Beyond any doubt, this analysis is correct. But it is not appropriate because of it
does not consider the leading quality of the decreased seventh in bar \texttt{2}
and bar \texttt{5}. An analysis which better covers our auditive understandings
could look like this:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 <  d' fis' a' c''>1  < e' g' b'>
    < e' g' c'' g''>1 < d' a' c'' fis''>1 < b g' d'' g''>1 }
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \setImHas "D[S]" #'(("a"."♮7"))
    \markup \setHas "Sp" #'()
    \markup \setHas "S" #'(("T"."d")("B"."3"))
    \markup \setImHas "D" #'(("a"."♮7"))
    \markup \setHas "S" #'(("B"."3"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

But even this analysis does not represent, what we hear. It does not capture the
functional relationship of \texttt{e-minor} in bar \texttt{3} and
\texttt{C-Major} in bar \texttt{4} which is established by the three common
tones. So, a better interpretation would also represent the chords in bar
\texttt{3} and \texttt{4} with respect to the chord in  bar \texttt{6}:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 <  d' fis' a' c''>1  < e' g' b'>
    < e' g' c'' g''>1 < d' a' c'' fis''>1 < b g' d'' g''>1 }
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \setImHas "D[S]" #'(("a"."♮7"))
    \markup \setImHas "Sp[S]" #'()
    \markup \setImHas "S[S]" #'(("B"."3"))
    \markup \setImHas "D[S]" #'(("a"."♮7"))
    \markup \setHas "S" #'(("B"."3"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

And here, we can directly see that all chords from bar \texttt{2} to bar
\texttt{5} functionally refer to the chord in bar \texttt{6}. Hence we hear an
intermediary chain of chords. \hlyn\ shall be able to represent such rows as it
is shown by the next interpretation:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  d' fis' a' c''>1 | < e' g' b'> |
    < e' g' c'' g''>1 | < d' a' c'' fis''>1 | < b g' d'' g''>1 |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \openImRow "D" #'(("a"."♮7"))
    \markup \setHas "Tp" #'()
    \markup \setHas "S" #'(("B"."3"))
    \markup \closeImRow "D" #'(("a"."♮7"))
    \markup \setHas "S" #'(("B"."3"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

The advantage of such a sophisticated analysis strikes the eye: only this last
interpretation syntactically represents the fact that we hear a deceptive
cadence in the row and that the complete chain of chords from bar \texttt{2} to
\texttt{6} as a unit fulfills the function of a subdomain.

Intermediary chains of chords can be created by explicitly open an intermediary
row, by inserting as many simple \has{s}\ as necessary and by explicitly closing
the intermediary row as it is shown here:
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  d' fis' a' c''>1 | < e' g' b'> |
    < e' g' c'' g''>1 | < d' a' c'' fis''>1 | < b g' d'' g''>1 |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
\end{verbatim}
{ \color{red} \verb|    \markup \openImRow "D" #'(("a"."-7"))| }
\begin{verbatim}
    \markup \setHas "Tp" #'()
    \markup \setHas "S" #'(("B"."3"))
\end{verbatim}
{ \color{red} \verb|    \markup closeImRow "D" #'(("a"."-7"))| }
\begin{verbatim}
    \markup \setHas "S" #'(("B"."3"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}

\end{verbatim}
\end{scriptsize}


Please keep in mind: It is not necessary that you agree with our analysis. The
example should only prove that \hlyn\ can grasp such complex relationships.

\subsection{Indicating the Context of Intermediary Chains of Chords}

But we must still tighten up the screw a bit more: If \hlyn\ shall be able to
represent deceptive cadences by indicating the expected function of an
intermediary chord and the really disappointing function of the subsequent chord
-- as it is shown here --

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  d' fis' a' c''>1 | < e' g' b'> |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \setImHas "D" #'(("a"."♮7")("C"."S"))
    \markup \setHas "Sp" #'()
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

then \hlyn\  must also be able to represent deceptive cadences which use
intermediary chains of chords followed by a functionally disappointing relative
chord:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  d' fis' a' c''>1 | < e' g' b'> |
    < e' g' c'' g''>1 | < d' a' c'' fis''>1 | < b g' e'' g''>1 |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \openImRow "D" #'(("a"."♮7"))
    \markup \setHas "Tp" #'()
    \markup \setHas "S" #'(("B"."3"))
    \markup \closeImRow "D" #'(("a"."♮7")("fr"."[S]"))
    \markup \setHas "Sp" #'(("B"."5"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

For indicating the context of an intermediary chain of chords you can use nearly
the same method used for creating an intermediary chain of chords without
indicating the content. But you have to add the attribute string
\texttt{("fr"."[YOUR\_CONTEXT]")} into the attribute list of the chord which
closes the intermediary row:

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  d' fis' a' c''>1 | < e' g' b'> |
    < e' g' c'' g''>1 | < d' a' c'' fis''>1 | < b g' e'' g''>1 |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \openImRow "D" #'(("a"."-7"))
    \markup \setHas "Tp" #'()
    \markup \setHas "S" #'(("B"."3"))
\end{verbatim}
{ \color{red} \verb|    \markup \closeImRow "D" #'(("a"."-7")("fr"."[S]"))| }
\begin{verbatim}
    \markup \setHas "Sp" #'(("B"."5"))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

The idea behind this method is that you here use the attribute
\acc{f(illstring)r(ight)} to append an the string \texttt{"[YOUR\_CONTEXT]"}

\subsection{Indicating Suspended and Passing Notes}

In other harmonic analyses, the musicologist wants to represent suspended or
passing notes although they do not modify the underlying harmonic function. It
is like he zooms in on the details of the chord. Here is an example of such a
'chordal movement':

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  e' g' a' d''>1 | < e' g' a' cis''> |
    < b  g' cis'' g''>1 | < b  g' d'' g''>1 | < b fis' d'' e''>1 |
    < ais fis' cis'' e''>1 | < ais fis' cis'' d''>1 | < b fis' b' d''>1 |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    % bar 2 - 3
    \markup \openZoomRow "D" #'(("B"."5")("a"."4")("b"."7"))
    \markup \expZoomRow #'(("a"."3")("b"."7"))
    % bar 4 - 5
    \initTextSpan "   "
    \markup \openZoomRow "S" #'(("B"."3")("a"."4"))
    \startTextSpan
    \markup \expZoomRow #'(("a"."5"))
    \stopTextSpan
    % bar 6 - 9
    \initTextSpan "   "
    \markup \openImZoomRow "D" #'(("B"."4")("a"."4")("b"."6")("c"."7"))
    \startTextSpan
    \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."7"))
    \markup \closeImZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."6"))
    \stopTextSpan

    \markup \setHas "Tp" #'()
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

For constructing this kind of descriptions you must open a zoom row before you
can expand it (\texttt{bar 2-3} and \texttt{bar 4-5}). Or you open an
intermediary zoom row, expand it and close it explicitly (\texttt{bar 6-9}). If
you want to create a line for indicating the zoom row graphically (\texttt{bar
4-5} and \texttt{bar 6-9} ), you must call the function \texttt{\textbackslash
initTextSpan} before the function \texttt{\textbackslash open[Im]ZoomRow}, the
function \texttt{\textbackslash startTextSpan} after the function
\texttt{\textbackslash open[Im]ZoomRow}, and the function \texttt{\textbackslash
stopTextSpan} after the last call of the function \texttt{\textbackslash
expZoomRow} respectively after having called the function \texttt{\textbackslash
closeImZoomRow} -- as it is shown in the code of the given example:

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  e' g' a' d''>1 | < e' g' a' cis''> |
    < b  g' cis'' g''>1 | < b  g' d'' g''>1 | < b fis' d'' e''>1 |
    < ais fis' cis'' e''>1 | < ais fis' cis'' d''>1 | < b fis' b' d''>1 |}
  \addlyrics {
    \markup \setHas "T" #'(("".""))
\end{verbatim}
\color{red}
\begin{verbatim}
    % bar 2 - 3
    \markup \openZoomRow "D" #'(("B"."5")("a"."4")("b"."7"))
    \markup \expZoomRow #'(("a"."3")("b"."7"))
\end{verbatim}
\color{blue}
\begin{verbatim}
    % bar 4 - 5
    \initTextSpan "   "
    \markup \openZoomRow "S" #'(("B"."3")("a"."4"))
    \startTextSpan
    \markup \expZoomRow #'(("a"."5"))
    \stopTextSpan
\end{verbatim}
\color{magenta}
\begin{verbatim}
    % bar 6 - 9
    \initTextSpan "   "
    \markup \openImZoomRow "D" #'(("B"."4")("a"."4")("b"."6")("c"."7"))
    \startTextSpan
    \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."7"))
    \markup \closeImZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."6"))
    \stopTextSpan
\end{verbatim}
\color{black}
\begin{verbatim}

    \markup \setHas "Tp" #'()
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}

Please note:
\begin{itemize}
  \item It is not necessary to close a normal zoom row by any specific function.
  But if you start with \texttt{\textbackslash initTextSpan} before
  \texttt{\textbackslash openZoomRow}, then you must call \texttt{\textbackslash
  stopTextSpan} after the last \texttt{\textbackslash expZoomRow}
  \item In case of a normal zoom row as well as in case of an intermediary zoom
  row, you may insert the function \texttt{\textbackslash expZoomRow} as often as
  it is required by your chord stream.
  \item In accordance with the nature of a zoom row, the functions
  \texttt{\textbackslash expZoomRow} and \texttt{\textbackslash closeImZoomRow}
  do not accept the parameter 'function symbol'. And they do not evaluate the
  attribute \texttt{"S"}.
\end{itemize}


Finally, some of you might have noticed, that the closure of an intermediary
zoom row sometimes can become a bit ugly (\texttt{bar 6-9}). Let us shortly
give reasons for that before we present a 'workaround':

\hlyn\ uses the method \acc{addlyrics} for binding the stream of symbols to the
stream of chords. Hence, each markup-command -- and every single word not being
embedded into a markup-command -- is mapped to the next chord of the voice to
which the analysis has been bound.\footnote{This seems to be the place for
indicating to a little trap: The method \acc{addlyrics} automatically maps two
or more notes - linked by a slur or a tie - to one word (or, in our case, to one
\has{}). This behaviour is disirable, if one deals with the text of songs. In
case of harmonic analyses it disturbs. There are two solutions: First, one can
resolve the slurs resp. ties where it is necessary. Or one can use the method
\acc{Binding \has{s} to a Hidden Voice} to decouple music and analysis. (\ra \
p. \pageref{HiddenVoice})} On the other hand, an intermediary row is indicated
by a left parenthesis as a prefix and a right parenthesis as a suffix.
From the viewpoint of \lily, the connection of the symbol and its prefix resp.
its suffix is that unit that is bound to a chord. But in a lyric stream, \lily\
only allows us to underscore such a unit as a whole, not only the 'half' of a
unit or a third or -- as it actually is required here -- the part before the
right parenthesis. That's the reason, why in this case the line in \texttt{bar
9} crosses the bracket an is drawn through to the right border of the chord.

The good message is, that you will rarely run into this visual deficiency:
it only arises in case of very long notes as we used here. Hence you mostly can
use this technique without any modifications.

But if you have nevertheless run into this trap, you can use a good
'workaround' to put yourself out of this misery:

\begin{itemize}
  \item Use the method \acc{Binding \has{s} to a Hidden Voice}\footnote{\ra p.
  \pageref{HiddenVoice}}
  \item Split the long note into a large note and a shorter note.
  \item Stop the text span before the shorter note.
  \item Close the intermediary row with the shorter note.
\end{itemize}

As your result you will get this:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\header { tagline = "" }

imInfix = " "

isVisible = { \stemUp
  < b  g' d'' g''>1 | < b fis' d'' e''>1 |
  < ais fis' cis'' e''>1 | < ais fis' cis'' d''>1 | < b fis' b' d''>1 |
}

isHidden = \relative d { \stemDown
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  d1 | d1 | d1 | d2. d4 | d1
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "S" #'(("B"."3"))
  \initTextSpan "      "
  \markup \openImZoomRow "D" #'(("B"."4")("a"."4")("b"."6")("c"."7"))
  \startTextSpan
  \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."7"))
  \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."6"))
  \stopTextSpan
  \markup \closeImZoomRow #'()
  \markup \setHas "Tp" #'()
}

\score {
  \new Staff <<
    \key d \major  \time 4/4 \clef treble
    \new Voice { \isVisible }
    % change "Voice" to "NullVoice" to make analyze voice unvisible:
    \new NullVoice = "inVisible" { \isHidden}
    \new Lyrics \lyricsto "inVisible" { \hasSymbols }
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}
\end{lilypond}
\end{center}

The trick becomes understandable if we unhide the hidden voice:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\header { tagline = "" }

imInfix = " " % don't forget this!

isVisible = { \stemUp
  < b  g' d'' g''>1 | < b fis' d'' e''>1 |
  < ais fis' cis'' e''>1 | < ais fis' cis'' d''>1 | < b fis' b' d''>1 |
}

isHidden = \relative d { \stemDown
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  d1 | d1 | d1 | d2. d4 | d1
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "S" #'(("B"."3"))
  \initTextSpan "      "
  \markup \openImZoomRow "D" #'(("B"."4")("a"."4")("b"."6")("c"."7"))
  \startTextSpan
  \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."7"))
  \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."6"))
  \stopTextSpan
  \markup \closeImZoomRow #'()
  \markup \setHas "Tp" #'()
}

\score {
  \new Staff <<
    \key d \major  \time 4/4 \clef treble
    \new Voice { \isVisible }
    % change "Voice" to "NullVoice" to make analyze voice unvisible:
    \new Voice = "inVisible" { \isHidden}
    \new Lyrics \lyricsto "inVisible" { \hasSymbols }
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}
\end{lilypond}
\end{center}

Here is the respective code:

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\header { tagline = "" }

imInfix = " " % don't forget this!

isVisible = { \stemUp
  < b  g' d'' g''>1 | < b fis' d'' e''>1 |
  < ais fis' cis'' e''>1 | < ais fis' cis'' d''>1 | < b fis' b' d''>1 |
}

isHidden = \relative d { \stemDown
  \override NoteHead.color = #red
  \override NoteColumn #'ignore-collision = ##t
  d1 | d1 | d1 | d2. d4 | d1
}

hasSymbols = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "S" #'(("B"."3"))
  \initTextSpan "      "
  \markup \openImZoomRow "D" #'(("B"."4")("a"."4")("b"."6")("c"."7"))
  \startTextSpan
  \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."7"))
  \markup \expZoomRow #'(("B"."3")("a"."3")("b"."5")("c"."6"))
  \stopTextSpan
  \markup \closeImZoomRow #'()
  \markup \setHas "Tp" #'()
}

\score {
  \new Staff <<
    \key d \major  \time 4/4 \clef treble
    \new Voice { \isVisible }
    % change "Voice" to "NullVoice" to make analyze voice unvisible:
    \new Voice = "inVisible" { \isHidden}
    \new Lyrics \lyricsto "inVisible" { \hasSymbols }
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}

\end{verbatim}
\end{scriptsize}

\subsection{Indicating Modulations}

One of the most important capabilities of a language to describe harmonic
relationships is the feature to represent harmonic modulations. In a modulation
the current function of a chord is re-interpreted with respect to a new tonal
center: In the context of \texttt{D-Major}, \texttt{e-minor} is the
\acc{relative of the subdominant}, but in the context of \texttt{C-Major}, it is
the \acc{counter relative of the tonic}. Using this ambiguity, \texttt{e-minor}
can act as linking chord which connects a section written in \texttt{D-Major}
with a section written in \texttt{C-Major}.

As far as we know, there still does not exist a coherently and commonly used
method to indicate such harmonic reframings.\footnote{One of the apologist of the
functional harmonic theory, Hugo de la Motte, prefers to use a line-based
concept with an overlapping section at the point of reframing: The first line
starts with the \has{s} related to the first tonal center up inclusively to the
chord, which is reinterpreted, and is continued by blanks. The second line
starts with blanks up to the beginning of the reinterpreted chord and is
continued by the \has{s} related to the second tonal center. (\cite[cf.][144 et
passim]{Delamotte2011a}) For the use in a score this method is a bit unwieldy.
Therefore, \hlyn\ 'only' labels the reinterpreted chord added by indicating the
modified context. To explicate the context by square brackets is used by de la
Motte too. (\cite[cf.][226 et passim]{Delamotte2011a})} Therefore, we propose a
straight forward approach: the two functions of the re-interpreted chord are
linked by an arrow and the complete complex is outlined by a rectangle:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  b g' d'' g''>1 | < cis' g' a' e''> | < d' fis' a' d''>1 |
    <  b g' e'' g''> | <  c' a' d'' f''> |
    <  d' f' g' b' > | < c' e' g' c''> |
    }
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \setHas "S" #'(("B"."3"))
    \markup \setHas "D" #'(("B"."3")("a"."7"))
    \markup \setHas "T" #'(("".""))
    % bar 5 - 6

    \markup \setRfHas "Sp" "Tg"
    #'( ("B"."5")("C" . "D")
        ("nB"."5")("nC" . "C")
    )

    \markup \setHas "S" #'(("B"."5")("a"."5")("b"."6"))
    \markup \setHas "D" #'(("B"."5")("a"."7"))
    % bar 4 - 5
    \markup \setHas "T" #'(("".""))
    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}


The complete syntax of such a reframing chord symbol can be demonstrated by using
the respective function itself:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
      < d' fis' a' d''>1
  }
  \addlyrics {
    \markup \setRfHas
        "FL"
        "FR"
    #'(
        ("fl" . "fl: LL  ")
        ("T"."x")
        ("B"."B: BL")
        ("S"."S: SL")
        ("a" . "a: L1")
        ("b" . "b: L2")
        ("c" . "c: L3")
        ("d" . "d: L4")
        ("e" . "e: L5")
        ("C" . "C: LC")
        ("fr" . "  fr: LR")

        ("nfl" . " nfl: RL ")
        ("nT"."d")
        ("nB"."nB: BR")
        ("nS"."nS: SR")
        ("na" . "na: R1")
        ("nb" . "nb: R2")
        ("nc" . "nc: R3")
        ("nd" . "nd: R4")
        ("ne" . "ne: R5")
        ("nC" . "nC: RC")
        ("nfr" . "  nfr: RR")
    )

  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

This artifical symbol is created by the respective code:

\begin{scriptsize}
\begin{verbatim}

\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
      < d' fis' a' d''>1
  }
  \addlyrics {
    \markup \setRfHas
        "F/L"
        "F/R"
    #'(
        ("fl" . "fl: LL  ")
        ("T"."x")
        ("B"."B: BL")
        ("S"."S: SL")
        ("a" . "a: L1")
        ("b" . "b: L2")
        ("c" . "c: L3")
        ("d" . "d: L4")
        ("e" . "e: L5")
        ("C" . "C: LC")
        ("fr" . "  fr: LR")

        ("nfl" . " nfl: RL ")
        ("nT"."d")
        ("nB"."nB: BR")
        ("nS"."nS: SR")
        ("na" . "na: R1")
        ("nb" . "nb: R2")
        ("nc" . "nc: R3")
        ("nd" . "nd: R4")
        ("ne" . "ne: R5")
        ("nC" . "nC: RC")
        ("nfr" . "  nfr: RR")
    )

  }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}


That it is helpful to have such a complex expressivity may be emphasized by the
next example:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  bes g' cis'' e''>1 | < aes c'' d'' f''> |
    <  g c'' e'' g''> | <  b f' g' d'' > | < c' e' g' c''> |
    }
  \addlyrics {
    \markup \setHas "T" #'(("".""))
    \markup \setRfHas "D" "D"
    #'( ("T"."x")("B"."♭9")("a"."7")("C" . "D")
        ("nT"."x")("nB"."7")("na"."♭9")("nC" . "C")
    )
    \markup \setHas "s" #'(("B"."♭3")("a"."5")("b"."6"))
    \markup \setHas "T" #'(("B"."5"))
    \markup \setHas "D" #'(("B"."3")("a"."7"))
    \markup \setHas "T" #'(("".""))

    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\section{Just for Fun: A Last Example}

Other than one seems to have thought up to now\footnote{Unfortunately, this is
not the right place for discussing the meaning of the famous 'Tristan-Chord' and
the histrory of the respective studies. The purpose of this chapter is to show
that \hlyn\ is indeed able to deal which such a complex research object.
Nevertheless, we think it is remarkable, that even one of the latest scientific
works does not use the complete arsenal of \has{s}\ to exemplify the meaning of
the considered positions: Petersen discusses the 'Tristan-Chord' on different
pages, but neither in the text, nor in his examples, he is using the complete
expressivity of the \acc{Functional Harmony Analysis}, as it
would be commensurate to the scores. (\cite[cf.][48f, 50f, 56ff,
59]{Petersen2019a}). He stands in a line with other illustrious analyses: If one
considers a central work for establishing the \acc{Theory of Functional Harmony
Analysis}, which at least informally defines the syntax and semantic of the
respective symbols (\cite[cf.][282]{Delamotte2011a}), then one has to state,
that even its author -- after having summarized some historical analyses of the
'Tristan-Chord' (\cite[cf.][225-227]{Delamotte2011a}) -- does not present his
own interpretation by using his own method (\cite[cf.][227f]{Delamotte2011a}).
How can this happen? It seem's that they do not trust their method -- which is
especially notable if one considers Petersen's appealing statement that 'chords
and accords should ever be analyzed and interpreted as intra-events of
cadences' (\cite[cf.][51]{Petersen2019a}).
We think, Petersen invocation is correct. And before we give up the theory by
murmurring about a 'real meaning' which has to be captured by musicality,
instead of being scientficly exemplified, we should apply the scientific theory
completely. If we do so, we can directly see, that the phase model of Petersen
is not adequate:
Bar 1 = phase 1 is correctly taken as an 'imperfect cadence of aminor'. But
taking bar 2 = phase 2 as an \enquote{Ausweichung nach C-Dur und Halbschluss auf
der Dominante} (=
'modulation? to C major with an imperfect cadence)
(\cite[cf.][51]{Petersen2019a}) does not consider, that there is a link between
the 'Tristan-Chord' at the preceeding 'chord' \acc{E major} in phase 1: the
'Tristan-Chord' can be taken as \acc{B major with 'sixt ajoutée'} which is
nothing else then the \DD{}\ of \acc{a minor}.
What can we conclude from this? We must define a sufficiently elaborated theory
of harmony analyses. In the tradition of defining programming languages we must
define this theory syntactically and semantically. Up to now, this has not been
done for the theory of the functional harmony analyses. And then, if we apply
such a theory, we will 'automatically' find the adequate interpretation - even
that of the 'Tristan-Chord'.}, the following, well-known example\footnote{For
the score \cite[cf.][\nopage]{wpTristan2019b}, for further hints
\cite[cf.][\nopage]{wpTristan2019a}} -- in toto -- is obviously nothing else
than a modulation from \acc{a-minor} to \acc{E-Major} using the a partially
irritating \acc{sixt ajoutée} in a major chord which afterwards is taken as a
suspended note of and leading note to the expected seventh\footnote{\texttt{bar
1} contains single tones instead of chords. Taking these tones as
representants of complete chords -- on the first glance  -- seems to be a bit
arbitrarily. But one has to keep in mind, that -- in the field -- we are
familiar to do so: every carnival, we understand a fanfare like \texttt{g c} as
a row of \texttt{D T}. In the same way, we understand the row \texttt{a f} as
\texttt{t  s}, which on the other hand evokes us that to take the succeding
\texttt{e} as the representant of the \texttt{D}. That's the way also Petersen
hears the first bar (phase 1) and describes it as “Halbschluss auf der
Dominante” (\cite[cf.][51]{Petersen2019a}) }:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\header { tagline = "" }

imInfix = " " % don't forget this!

trisSone =  { \stemUp
  \partial 8 \skip8 | \skip2. | gis'4.~ gis'4 a'8 | ais'8 b'4~ b'8 \skip8 \skip8 |
}

trisStwo = { \stemDown
  \partial 8 r8 | R2. | <f b dis'>2. | <e gis d'!>4.~ <e gis d'>8 r8 r8 |
}

trisBone = { \stemUp
  \partial 8 \skip8 | \skip2. | <f b gis'>4.~ <f b gis'>8 \skip8 \skip8 | \skip2. |
}

trisBtwo =  { \stemDown
  \partial 8 a8 | f'4.~ f'4 e'8 | dis'4.~ dis'8 b8\rest b8\rest | R2. |
}

trisBana =  { \stemDown
  \partial 8 c,8 | c4.~ c4 c,8 | c4.~ c4 c,8 | c,8 c,4~ c,4 r8 |
}

trisSymb = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "t" #'(("C" . "a")("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "s" #'(("B"."3")("a" . "1")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))


  \markup \setRfHas "D" "T"
    #'( ("C" . "a") ("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") )
        ("nC" . "E") ("na" . "3")("nb" . "5")("nc" . "8")("nn" . ("a" "b" "c") )
    )
  \initTextSpan "        "
  \markup \openZoomRow "D" #'(("C" . "E")("B" . "5")("a" . "5")("b" . "6"))
  \startTextSpan
  \markup \expZoomRow #'(("a" . "5")("b" . "7"))
  \stopTextSpan

  \initTextSpan "        "
  \markup \openZoomRow "T" #'(("a"."♯4"))
  \startTextSpan
  \markup \expZoomRow  #'(("a"."5"))
  \stopTextSpan
}

trisChord = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)
  \override Score.BarNumber.break-visibility = #'#(#t #t #t)

  \markup \setHas "a" #'(("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "d" #'(("B"."3")("a" . "1")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "E" #'(("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c")) )

  \initTextSpan "     "
  \markup \openZoomRow "B" #'(("B" . "5")("a" . "5")("b" . "6"))
  \startTextSpan
  \markup \expZoomRow #'(("a" . "5")("b" . "7"))
  \stopTextSpan

  \initTextSpan "      "
  \markup \openZoomRow "E" #'(("a"."♯4"))
  \startTextSpan
  \markup \expZoomRow  #'(("a"."5"))
  \stopTextSpan

}

\score {
  <<
    \new GrandStaff <<
      \time 6/8
      \new Staff <<
        \clef "treble" \key  a\minor
        \new Voice = "trisSone" { \trisSone }
        \new Voice = "trisStwo" { \trisStwo }
      >>
      \new Staff <<
        \clef "bass"\key  a\minor
        \new Voice = "trisBone" { \trisBone }
        \new Voice = "trisBtwo" { \trisBtwo }
        \new NullVoice = "trisBana" { \trisBana }
        \new Lyrics \lyricsto "trisBana" { \trisSymb }
        \new Lyrics \lyricsto "trisBana" { \trisChord }
      >>
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}
\end{lilypond}
\end{center}


Alternatively, we could understand the 'Tristan-Chord' as \acc{gis-minor} with
an added small seventh (= \HH.gis.7.7...) which  functionally has to be taken as
\HH.{\DD}p.7.7... in the context of \acc{a-minor}, respectively as
\HH.{D}p.7.7... in the context of \acc{E-major}. In this case, the alteration of
the \acc{gis} into an \acc{a} (\ra\ \texttt{bar 2}) while continuing the other
tones of the chord (in at least some lower voices) let finally become the chord
a \acc{dominant seventh chord}:


\begin{center}
\begin{lilypond}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\header { tagline = "" }

imInfix = " " % don't forget this!

trisSone =  { \stemUp
  \partial 8 \skip8 | \skip2. | gis'4.~ gis'4 a'8 | ais'8 b'4~ b'8 \skip8 \skip8 |
}

trisStwo = { \stemDown
  \partial 8 r8 | R2. | <f b dis'>2. | <e gis d'!>4.~ <e gis d'>8 r8 r8 |
}

trisBone = { \stemUp
  \partial 8 \skip8 | \skip2. | <f b gis'>4.~ <f b gis'>8 \skip8 \skip8 | \skip2. |
}

trisBtwo =  { \stemDown
  \partial 8 a8 | f'4.~ f'4 e'8 | dis'4.~ dis'8 b8\rest b8\rest | R2. |
}

trisBana =  { \stemDown
  \partial 8 c,8 | c4.~ c4 c,8 | c4.~ c4 c,8 | c,8 c,4~ c,4 r8 |
}

trisSymb = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "t" #'(("C" . "a")("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "s" #'(("B"."3")("a" . "1")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))


  \markup \setRfHas "D" "T"
    #'( ("C" . "a") ("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") )
        ("nC" . "E") ("na" . "3")("nb" . "5")("nc" . "8")("nn" . ("a" "b" "c") )
    )


  \markup \setHas "Dp" #'(("C" . "E")("B" . "7")("a" . "7"))
  \markup \setHas "D" #'(("C" . "E")("B" . "5")("a" . "7"))

  \initTextSpan "        "
  \markup \openZoomRow "T" #'(("a"."♯4"))
  \startTextSpan
  \markup \expZoomRow  #'(("a"."5"))
  \stopTextSpan
}

trisChord = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)
  \override Score.BarNumber.break-visibility = #'#(#t #t #t)

  \markup \setHas "a" #'(("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "d" #'(("B"."3")("a" . "1")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "E" #'(("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c")) )

  \markup \setHas "g♯" #'(("C" . "E")("B" . "7")("a" . "7"))
  \markup \setHas "B" #'(("C" . "E")("B" . "7")("a" . "7"))


  \initTextSpan "      "
  \markup \openZoomRow "E" #'(("a"."♯4"))
  \startTextSpan
  \markup \expZoomRow  #'(("a"."5"))
  \stopTextSpan

}

\score {
  <<
    \new GrandStaff <<
      \time 6/8
      \new Staff <<
        \clef "treble" \key  a\minor
        \new Voice = "trisSone" { \trisSone }
        \new Voice = "trisStwo" { \trisStwo }
      >>
      \new Staff <<
        \clef "bass"\key  a\minor
        \new Voice = "trisBone" { \trisBone }
        \new Voice = "trisBtwo" { \trisBtwo }
        \new NullVoice = "trisBana" { \trisBana }
        \new Lyrics \lyricsto "trisBana" { \trisSymb }
        \new Lyrics \lyricsto "trisBana" { \trisChord }
      >>
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}
\end{lilypond}
\end{center}


Thus, we probably may conclude, that using \hlyn\ makes it easier to understand
the \acc{Tristan chord} as well as writing the appropriate analysis. That's a
nice result isn't it? Howsoever, here is the respective code:

\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\include "lilypond/harmonyli.ly"

\header { tagline = "" }

imInfix = " " % don't forget this!

trisSone =  { \stemUp
  \partial 8 \skip8 | \skip2. | gis'4.~ gis'4 a'8 | ais'8 b'4~ b'8 \skip8 \skip8 |
}

trisStwo = { \stemDown
  \partial 8 r8 | R2. | <f b dis'>2. | <e gis d'!>4.~ <e gis d'>8 r8 r8 |
}

trisBone = { \stemUp
  \partial 8 \skip8 | \skip2. | <f b gis'>4.~ <f b gis'>8 \skip8 \skip8 | \skip2. |
}

trisBtwo =  { \stemDown
  \partial 8 a8 | f'4.~ f'4 e'8 | dis'4.~ dis'8 b8\rest b8\rest | R2. |
}

trisBana =  { \stemDown
  \partial 8 c,8 | c4.~ c4 c,8 | c4.~ c4 c,8 | c,8 c,4~ c,4 r8 |
}

trisSymb = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)

  \markup \setHas "t" #'(("C" . "a")("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "s" #'(("B"."3")("a" . "1")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))


  \markup \setRfHas "D" "T"
    #'( ("C" . "a") ("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") )
        ("nC" . "E") ("na" . "3")("nb" . "5")("nc" . "8")("nn" . ("a" "b" "c") )
    )
  \initTextSpan "        "
  \markup \openZoomRow "D" #'(("C" . "E")("B" . "5")("a" . "5")("b" . "6"))
  \startTextSpan
  \markup \expZoomRow #'(("a" . "5")("b" . "7"))
  \stopTextSpan

  \initTextSpan "        "
  \markup \openZoomRow "T" #'(("a"."+4"))
  \startTextSpan
  \markup \expZoomRow  #'(("a"."5"))
  \stopTextSpan
}

trisChord = \lyricmode {
  \override LyricText.self-alignment-X = #LEFT
  \override LyricExtender.left-padding = #-0.5
  \override LyricExtender.extra-offset = #'(0 . 0.5)
  \override Score.BarNumber.break-visibility = #'#(#t #t #t)

  \markup \setHas "a" #'(("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "d" #'(("B"."3")("a" . "1")("b" . "5")("c" . "8")("n" . ("a" "b" "c") ))
  \markup \setHas "E" #'(("a" . "3")("b" . "5")("c" . "8")("n" . ("a" "b" "c")) )

  \initTextSpan "     "
  \markup \openZoomRow "B" #'(("B" . "5")("a" . "5")("b" . "6"))
  \startTextSpan
  \markup \expZoomRow #'(("a" . "5")("b" . "7"))
  \stopTextSpan

  \initTextSpan "      "
  \markup \openZoomRow "E" #'(("a"."+4"))
  \startTextSpan
  \markup \expZoomRow  #'(("a"."5"))
  \stopTextSpan

}

\score {
  <<
    \new GrandStaff <<
      \time 6/8
      \new Staff <<
        \clef "treble" \key  a\minor
        \new Voice = "trisSone" { \trisSone }
        \new Voice = "trisStwo" { \trisStwo }
      >>
      \new Staff <<
        \clef "bass"\key  a\minor
        \new Voice = "trisBone" { \trisBone }
        \new Voice = "trisBtwo" { \trisBtwo }
        \new NullVoice = "trisBana" { \trisBana }
        \new Lyrics \lyricsto "trisBana" { \trisSymb }
        \new Lyrics \lyricsto "trisBana" { \trisChord }
      >>
    >>
  >>
  \layout{ \context { \Lyrics \consists "Text_spanner_engraver" } }
}


\end{verbatim}
\end{scriptsize}


\section{Package Content}

\dirtree{%
.1 harmonyli.ly \com{}.
.2 AUTHORS \com{reference to the copyright holder}.
.2 cadenca-func.ly \com{example}.
.2 cadenca-scale.ly \com{example}.
.2 CHANGES \com{changes of the major releases}.
.2 doc \com{documentation}.
.3 Makefile \com{type \texttt{make} to create the tutorial }.
.3 source $\vartriangleleft$ \com{\LaTeX sources of the tutorial}.
.3 tutorial.pdf \com{latest stable version}.
.2 harmonyli.ly \com{\textbf{the library itself}}.
.2 img $\vartriangleleft$ \com{png compilations of the examples}
.2 LICENSE.GPL \com{GPL license txt}.
.2 LICENSE.MIT \com{MIT license text}.
.2 LICENSING \com{dual licensing files}.
.2 Makefile \com{type \texttt{make \$f.pdf} to create \$.pdf}.
.2 minimal.ly \com{example}.
.2 modulation-func.ly \com{example}.
.2 modulation-scale.ly \com{example}.
.2 README.md \com{github markdown readme}.
.2 release \com{current stable release}.
.2 sn967.ly \com{refrence example}.
.2 xtras \com{}.
.3 blum $\vartriangleleft$ \com{sources of Blum's original version}.
.3 klaus-blum-licensing-approval.mbox \com{approval mail}.
}


\section{FAQ}
\label{FAQ}
\subsection{What's the purpose of the prefix / suffix?}

\hlyn\ offers the opportunity, to 'expand' a \has{}\ by a prefix and/or a
suffix. You can insert such prefixes or suffixes by adding the attributes
\texttt{("fl" . "prefix")} resp. \texttt{("fr" . "suffix")} into the list of
attributes. In this way, you can insert verbal hints or influence \lily.

\subsection{Can a I increase the distance between the parentheses and the symbol of intermediary chords?}

Yes you can. Type \texttt{imInfix = " "} just before your section \texttt{score}

\subsection{How can I prevent that a zoom row line starts too early?}

Increase the number of blanks handed over as value of the parameter by using the
function \texttt{\textbackslash initTextSpan "      "}

\subsection{Does \hlyn\ offer some abbreviations?}

Yes. There are some often used \has{s}, which \hlyn\ offers as special symbols.
But note, they only accept a very reduced subset of parameters:

\begin{description}
  \item[\textbackslash FHAS \$HAS] ::- inserts the respective \has{}.
  \item[\textbackslash FHASth \$HAS] ::- inserts the first inversion of a \has{}.
  \item[\textbackslash Dsept \$HAS] ::- inserts a dominant plus seven.
  \item[\textbackslash Dseptnone \$HAS] ::- inserts a dominant plus seventh and nineth.
\end{description}

Here is a an example:

\begin{center}
\begin{lilypond}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  bes g' cis'' e''>1 | < aes c'' d'' f''> |
    <  g c'' e'' g''> | <  b f' g' d'' > | < c' e' g' c''> |
    }
  \addlyrics {
    \markup \FHAS "T"
    \markup \Dseptnone
    \markup \FHASth "s"
    \markup \FHAS "T"
    \markup \Dsept
    \markup \FHAS "T"

    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{lilypond}
\end{center}

\ldots adn this its code:
\begin{scriptsize}
\begin{verbatim}
\version "2.18.2"
\header { tagline = "" }
\include "lilypond/harmonyli.ly"
\score {
  \new Staff { \clef "treble" \key d \major \time 4/4 \stemUp
    \override Score.BarNumber.break-visibility = #'#(#t #t #t)
    < d' fis' a' d''>1 | <  bes g' cis'' e''>1 | < aes c'' d'' f''> |
    <  g c'' e'' g''> | <  b f' g' d'' > | < c' e' g' c''> |
    }
  \addlyrics {
    \markup \FHAS "T"
    \markup \Dseptnone
    \markup \FHASth "s"
    \markup \FHAS "T"
    \markup \Dsept
    \markup \FHAS "T"

    }
  \layout { \context { \Lyrics \consists "Text_spanner_engraver" } }
  \midi {}
}
\end{verbatim}
\end{scriptsize}
\subsection{can you offer a synopsis of concepts, translations, and symbols?}

Yes, we\footnote{In this context, I have first of all to thank Leo Correia de
Verdier (who delivered the basic version of the following table to me) and
Gregory Hollands (who led me to some respective sites)} can:

\begin{tabular}{|l|l|l|}
\hline
Symbol & German & English \tabularnewline
\hline
\hline
T      & Tonika                 & tonic \\
\hline
Tp     & Tonika-Parallele       & relative of the tonic \\
\hline
Tg     & Tonika-Gegenklang      & counter-relative of the tonic \\
\hline
S      & Subdominante           & subdominant \\
\hline
Sp     & Subdominant-Parallele  & relative of the subdominant \\
\hline
Sg     & Subdominant-Gegenklang & counter-relative of the subdominant \\
\hline
SS     & Doppelsubdominante     & subdominant of the subdominant \\
\hline
D      & Dominante              & dominant \\
\hline
Dp     & Dominant-Parallele     & relative of the dominant \\
\hline
Dg     & Dominant-Gegenklang    & counter-relative of the dominant \\
\hline
DD     & Doppeldominante        & dominant of the dominant \\
\hline
\hline

\end{tabular}

If you need translations of musical concepts, please take a look at
sengpielaudio\footcite[cf.][\nopage wp]{sengpielaudio2019a}.













% insert the nomenclature here

\input{bib/ncl.abbreviations.tex}
%\input{bib/ncl.journals}
\printnomenclature

% insert the bibliographical data here
\bibliography{bib/literature}

\end{document}
